'use strict';$msRoot.createNS("Gradient");
$msRoot.Gradient=function(C){function l(a){t.push(this);this.id="ms-gradient-"+x++ +"-";this.aGradient=[];this.gradient;this.opacitySlider;this.currStop=-1;this.barMousedownSet=[];this.cs;this.deleteStopListener;this.cpLibrary;this.currLayer=-1;this.layerCounter=0;this.layerBusy=!1;this.string;this.allLayersString;this.undoString;this.tab=0;this.lastDeletedStop={color:void 0,alpha:void 0};this.cssMode="rgb";this.degreesDialogOpen=this.init=!1;this.vendorFunctionPrefix=$ms.vendorFunctionPrefix("background",
"linear-gradient","(to top, black, white)","(top, black, white)");this.settings=$ms.cloneSettings(y,a);this.settings.container||(this.settings.container=document.body);a={saveLabel:"Save",cbSetColor:function(b){var c=b.name;2==this.tab?(c={id:this.id,dialogTitle:"Load Gradient",text:"Load a new gradient or add layer(s) to the current one?",buttons:[{label:"Gradient",title:"Replace the current gradient.",cb:function(){this.showGradientFromString(b.gradient)}.bind(this)},{label:"Layer(s)",title:"Add layer(s) to the existing gradient",
cb:function(){this.showGradientFromString(b.gradient,!0)}.bind(this)},{label:"Cancel",title:"Do not load the gradient"}],position:"fixed",textAlign:"left",buttonClass:"ms-gradient-button",buttonsOnTop:!0},new $msRoot.CustomDialog(c)):(this.setColor(b.gradient),this.cpLibrary.colorNameCombo.setValue(c))}.bind(this),libSuffix:"gradient",valueToSet:"gradient",cbResize:function(b){this.colorLibResize(b)}.bind(this)};this.cpLibrary=new $msRoot.ColorPicker.ColorLibrary(a);this.container=this.createForm();
$ms.draggable(this.container,{scope:"default",handle:this.id+"title-bar",cbDrop:this.drop.bind(this)});this.opacityInput=$ms.$(this.id+"opacity-stop-input");this.opacityLocationInput=$ms.$(this.id+"opacity-stop-location");this.colorInput=$ms.$(this.id+"color-stop-input");this.colorLocationInput=$ms.$(this.id+"color-stop-location");this.opacityDelete=$ms.$(this.id+"opacity-delete-area");this.colorDelete=$ms.$(this.id+"color-delete-area");this.opacityBar=$ms.$(this.id+"opacity-bar");this.colorBar=$ms.$(this.id+
"color-bar");this.direction=$ms.$(this.id+"gradient-direction");this.tabsContainer=$ms.$(this.id+"tab-container");this.previewOuter=$ms.$(this.id+"preview-outer");this.previewWrapper=$ms.$(this.id+"preview-wrapper");this.previewWrapper2=$ms.$(this.id+"preview-wrapper2");this.preview=$ms.$(this.id+"preview");this.previewWidth=$ms.$(this.id+"export-width");this.previewHeight=$ms.$(this.id+"export-height");this.cssOuter=$ms.$(this.id+"css-outer");this.cssText=$ms.$(this.id+"css-text");this.layersOuter=
$ms.$(this.id+"layers-outer");this.layersUl=$ms.$(this.id+"layer-ul");this.layersPreviewWrapper=$ms.$(this.id+"layers-preview-wrapper");this.importOuter=$ms.$(this.id+"import-outer");this.importText=$ms.$(this.id+"import-text");this.opacityInput.addEventListener("keydown",function(b){this.keydown(b,0,100,this.opacityInputKeyup)}.bind(this));this.opacityLocationInput.addEventListener("keydown",function(b){this.keydown(b,0,100,this.opacityLocationKeyup)}.bind(this));this.colorLocationInput.addEventListener("keydown",
function(b){this.keydown(b,0,100,this.colorLocationKeyup)}.bind(this));this.opacityLocationInput.addEventListener("keyup",function(b){this.opacityLocationKeyup(b)}.bind(this));this.colorLocationInput.addEventListener("keyup",function(b){this.colorLocationKeyup(b)}.bind(this));this.opacityInput.addEventListener("keyup",function(b){this.opacityInputKeyup(b)}.bind(this));this.opacityLocationInput.addEventListener("blur",function(b){this.opacityLocationBlur(b)}.bind(this));this.colorLocationInput.addEventListener("blur",
function(b){this.colorLocationBlur(b)}.bind(this));this.opacityInput.addEventListener("blur",function(b){this.opacityInputBlur(b)}.bind(this));this.previewWidth.addEventListener("keydown",function(b){this.keydown(b,0,5E3,this.resizePreview)}.bind(this));this.previewHeight.addEventListener("keydown",function(b){this.keydown(b,0,5E3,this.resizePreview)}.bind(this));this.previewWidth.addEventListener("keyup",function(b){this.resizePreview(b)}.bind(this));this.previewHeight.addEventListener("keyup",function(b){this.resizePreview(b)}.bind(this));
this.cpLibrary.libraryNameCombo.setValue("Default");this.cpLibrary.libraryNameCombo.settings.cbChange({value:"Default"},!0);this.showTab(0);this.showGradient(this.settings.startColor);if(this.settings.cbCreate)if(Array.isArray(this.settings.cbCreate))for(a=0;a<this.settings.cbCreate.length;a++)this.settings.cbCreate[a](this);else this.settings.cbCreate(this)}var t=[],x=0,y={startColor:"",newGradient:"rgb(255,255,255)",newLayer:"linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(0,0,0,1) 100%)",
imgPath:$ms.STATIC_JS_COMMON+"/colorpicker/img",target:void 0,top:"100px",left:"100px",fontSize:75,zIndex:1E3,container:void 0,cbUpdateColorPicker:void 0,cbClose:void 0,cbChange:void 0,cbCreate:void 0,pinColorPicker:!1,colorPicker:void 0,minimal:!1};$ms.sourceFiles.add([{file:"localdata.min.js",ns:"LocalData"},{file:"localfile.min.js",ns:"LocalFile"},{file:"editable-combo.min.js",ns:"EditableCombo"},{file:"custom-dialog.min.js",ns:"CustomDialog"},{file:"dragdrop.min.js",ns:"DragDrop"},{file:"slider.min.js",
ns:"Slider"},{file:"colorpicker.min.js",ns:"ColorPicker",subDir:"colorpicker"},{file:"colorlibrary.min.js",ns:"ColorPicker.ColorLibrary",subDir:"colorpicker"}]);$ms.sourceFiles.load();l.getInstance=function(a){if("undefined"!==typeof a)for(var b=0;b<t.length;b++){if(t[b].id==a)return t[b]}else return t};l.prototype.onLoad=function(){var a=this;this.init||(this.init=!0,$ms.removeClass(this.container,"display-none"),this.drop(),this.resizePreview(),this.observer=new $ms.MutationObserver,this.observer.observe("#"+
this.tabsContainer.id,{observe:{attributes:!0,attributeOldValue:!0,attributeFilter:["style"]},querySelectorAll:!1,cb:function(b,c){try{a.resizePreview.call(a)}catch(f){}}.bind(this),property:["height","width"]}))};l.prototype.showGradient=function(a){-1!==a.indexOf("gradient")?this.showGradientFromString(a):this.showGradientFromColor(a);this.onLoad()};l.prototype.showGradientFromColor=function(a,b){-1!==a.indexOf("gradient")?this.showGradientFromString(a,b):(this.resetSliders(),this.gradient={},this.string=
void 0,this.currStop=-1,a=$msRoot.colorMethods.colorInfo(a),a=""==a.rgbString?$msRoot.colorMethods.rgbToRgba([255,255,255],1):a.rgbString,this.layerBusy=!0,this.addStop({position:0,colorValue:a,type:"color",makeActive:!0}),this.addStop({position:100,colorValue:a,type:"color"}),this.addStop({position:0,opacityValue:1,type:"opacity"}),this.addStop({position:100,opacityValue:1,type:"opacity"}),this.layerBusy=!1,this.currStop=0,this.selectStopSlider(this.cs[0].slider),b?this.aGradient.splice(0,0,this.gradient):
(this.resetLayers(),this.aGradient=[this.gradient]),this.currLayer=0,this.createLayerLi(0),this.selectLayer(this.aGradient[0].li),this.updateVisuals(),0==this.settings.startColor.length&&(this.settings.startColor=this.string.noPrefix))};l.prototype.resetLayers=function(){for(;this.layersUl.hasChildNodes();)this.layersUl.removeChild(this.layersUl.firstChild)};l.prototype.createLayerLi=function(a){var b=document.createElement("li");b.id=this.id+"li-"+this.layerCounter++;b.className="li-layer";this.aGradient[a].string=
this.getGradientString(this.aGradient[a]);this.aGradient[a].li=b;var c=this.selectLayer.bind(this),f=document.createElement("div");f.className="ms-cp-transparent-grid";b.appendChild(f);var d=document.createElement("div");!function(g){g.addEventListener("click",function(){c(g,!0)})}(b);var e={scope:"layers",containment:this.layersUl};$ms.draggable(b,e);e={scope:"layers",insert:"li.li-layer",classes:{active:"ms-highlight-border"},cbDrop:this.updateFromDragDrop.bind(this)};$ms.droppable(b,e);f.appendChild(d);
this.setBackground(d,this.aGradient[a].string);this.layersUl.childNodes.length<a+1?this.layersUl.appendChild(b):this.layersUl.insertBefore(b,this.layersUl.childNodes[a])};l.prototype.showGradientFromString=function(a,b){"undefined"!==typeof a&&"undefined"==typeof this.settings.startColor&&(this.settings.startColor=a);if(-1==a.indexOf("gradient"))this.showGradientFromColor(a);else if((a=this.getParsedGradient(a))&&0!=a.length){if(b)for(var c=0;c<a.length;c++)this.aGradient.splice(c,0,a[c]),this.createLayerLi(c);
else for(this.resetLayers(),this.aGradient=a,c=0;c<a.length;c++)this.createLayerLi(c);this.resetSliders(b);this.selectLayer(this.aGradient[0].li);this.currLayer=0;this.gradient=this.aGradient[this.currLayer];this.string=this.gradient.string;this.direction.value=this.gradient.direction;"undefined"!==typeof this.gradient.angle&&(b=this.angleToDirection(this.gradient.angle),!1!==b?(this.gradient.direction=b,this.direction.value=b):-1!==this.gradient.angle.indexOf("deg")&&(b=parseInt(this.gradient.angle),
this.direction.value=this.addDegreeComboOption(b)));this.cs=this.gradient.colorStop;this.colorStopsToSliders();for(c=0;c<this.cs.length;c++)if("color"==this.cs[c].type){this.currStop=c;this.selectStopSlider(this.cs[c].slider);break}$ms.removeClass(this.container,"display-none");this.positionArrows();this.currLayer=0}else this.showGradientFromColor("rgba(255, 255, 255, 1)")};l.prototype.addDegreeComboOption=function(a){a=parseInt(""+a);if(isNaN(a))return"";a="degrees: "+a;for(var b=0;b<this.direction.options.length;b++)"degrees: "==
this.direction.options[b].value.substr(0,9)&&this.direction.removeChild(this.direction.options[b]);b=document.createElement("option");b.value=a;b.innerHTML=a;this.direction.appendChild(b);return a};l.prototype.bringToFront=function(){for(var a=0,b=0;b<t.length;b++)t.id!==this.id&&(a=Math.max(a,parseInt(t[b].container.style.zIndex)));var c=$msRoot.ColorPicker.getInstance();for(b=0;b<c.length;b++)a=Math.max(a,parseInt(c[b].container.style.zIndex));this.container.style.zIndex=Math.max(parseInt(this.container.style.zIndex),
a+1)};l.prototype.createForm=function(){var a,b=document.createElement("div");b.id=this.id+"container";b.className="ms-gradient draggable target display-none";b.style.top=this.settings.top;b.style.left=this.settings.left;b.style.zIndex=this.settings.zIndex;var c=document.createElement("div");c.id=this.id+"title-bar";c.className="ms-title-bar draghandle";c.draggable=!0;c.innerHTML="Gradient Generator";c.addEventListener("mousedown",function(){this.bringToFront()}.bind(this));var f=$ms.createCloseButton(this.id,
function(){this.cancel()}.bind(this));c.appendChild(f);b.appendChild(c);f=document.createElement("div");f.className="ms-gradient-left-outer";b.appendChild(f);c=document.createElement("div");c.className="ms-gradient-direction";f.appendChild(c);var d=document.createElement("div");d.innerHTML="Direction";d.className="ms-gradient-label";c.appendChild(d);var e={onchange:function(){this.gradient.direction=this.direction.value;"degrees"==this.direction.value?this.degreesDialogOpen||this.degreesDialog():
(this.gradient.degrees=this.validateDegrees(this.gradient.direction),this.updateVisuals())}.bind(this),defaultValue:"to bottom"};d=$ms.createCombo([{label:"bottom \u2193",value:"to bottom"},{label:"right \u2192",value:"to right"},{label:"top \u2191",value:"to top"},{label:"left \u2190",value:"to left"},{label:"top right \u2197",value:"45deg"},{label:"bottom right \u2198",value:"135deg"},{label:"bottom left \u2199",value:"225deg"},{label:"top left \u2196",value:"315deg"},{label:"radial \u25cb",value:"radial"},
{label:"degrees",value:"degrees"}],e);d.id=this.id+"gradient-direction";d.style.marginTop="5px";d.style.fontSize="90%";c.appendChild(d);c=document.createElement("div");c.className="ms-gradient-slider-outer";f.appendChild(c);d=document.createElement("div");d.id=this.id+"opacity-stop-container";d.style.width="100%";d.style.position="relative";c.appendChild(d);e=document.createElement("div");e.id=this.id+"opacity-delete-area";e.style.marginBottom="5px";e.style.height="10px";e.style.width="350px";d.appendChild(e);
e=document.createElement("div");e.id=this.id+"opacity-bar";e.className="ms-gradient-slider-bar ms-gradient-opacity-bar";e.style.height="20px";e.style.width="350px";d.appendChild(e);d=document.createElement("div");d.style.height="20px";d.style.width="350px";d.className="ms-cp-transparent-grid";c.appendChild(d);e=document.createElement("div");e.id=this.id+"gradient-bar";e.style.height="100%";e.style.width="100%";d.appendChild(e);d=document.createElement("div");d.id=this.id+"color-stop-container";d.style.position=
"relative";d.style.width="350px";c.appendChild(d);e=document.createElement("div");e.id=this.id+"color-bar";e.className="ms-gradient-slider-bar ms-gradient-color-bar";e.style.height="20px";e.style.width="350px";d.appendChild(e);e=document.createElement("div");e.id=this.id+"color-delete-area";e.style.marginTop="5px";e.style.height="10px";e.style.width="350px";d.appendChild(e);d=document.createElement("div");d.className="ms-gradient-reset";d.title="Reset default color stop - will calculate based on position not last deleted stop.";
d.addEventListener("click",function(n){this.lastDeletedStop={color:void 0,alpha:void 0}}.bind(this));c.appendChild(d);d=document.createElement("div");d.className="ms-gradient-reverse";d.title="Reverse order of color stops.";d.addEventListener("click",function(n){for(n=0;n<this.cs.length;n++)this.cs[n].position=100-this.cs[n].position;this.selectLayer(this.aGradient[this.currLayer].li,!0);this.updateVisuals()}.bind(this));c.appendChild(d);c=document.createElement("div");c.className="ms-gradient-title-stops";
c.innerHTML="Stops";f.appendChild(c);d=document.createElement("table");d.className="ms-gradient-stop-table";c=[155,155];e=document.createElement("colgroup");d.appendChild(e);for(a=0;a<c.length;a++){var g=document.createElement("col");e.appendChild(g);g.style.width=c[a]+"px"}f.appendChild(d);a=document.createElement("tr");d.appendChild(a);e=document.createElement("td");e.style.verticalAlign="top";a.appendChild(e);c=document.createElement("div");c.innerHTML="Opacity";c.className="ms-gradient-label";
c.style.width="50px";e.appendChild(c);e={min:0,max:100,snapX:1,sliderWidth:65,inputWidth:30,inputId:this.id+"opacity-stop-input",textAfterInput:" %",button:!1,sliderInput:!0,parentNode:e,imgPath:this.settings.imgPath};this.opacitySlider=new $msRoot.Slider(void 0,e);this.opacitySlider.onValuesChanged=function(){this.opacityInput.value=parseInt(this.opacitySlider.xValue);this.updateGradientFromInput();this.updateVisuals()}.bind(this);e=document.createElement("td");e.style.verticalAlign="top";a.appendChild(e);
c=document.createElement("div");c.innerHTML="Location";c.className="ms-gradient-label";e.appendChild(c);c=document.createElement("input");c.id=this.id+"opacity-stop-location";c.size=3;c.style.display="inline-block";c.style.width="35px";e.appendChild(c);c=document.createElement("div");c.innerText="%";c.style.display="inline-block";c.style.marginLeft="2px";c.style.marginRight="5px";e.appendChild(c);c=document.createElement("div");c.style.display="inline-block";c.style.width="45px";c.innerHTML="Delete";
c.className="ms-gradient-button";c.addEventListener("click",function(n){this.deleteOpacityStop(n)}.bind(this));e.appendChild(c);a=document.createElement("tr");d.appendChild(a);e=document.createElement("td");e.style.verticalAlign="top";a.appendChild(e);c=document.createElement("div");c.innerText="Color";c.className="ms-gradient-label";c.style.width="50px";e.appendChild(c);c=document.createElement("div");c.id=this.id+"color-stop-input";c.className="ms-gradient-color-stop-input";c.addEventListener("click",
function(){this.colorInputSelected("color-input")&&this.openColorPicker()}.bind(this));e.appendChild(c);d=document.createElement("div");d.className="ms-gradient-button ms-button-tool ms-gradient-color-stop-button";d.innerHTML="\u25ba";d.addEventListener("click",function(){this.colorInputSelected("color-input")&&this.openColorPicker()}.bind(this));e.appendChild(d);e=document.createElement("td");e.style.verticalAlign="top";a.appendChild(e);c=document.createElement("div");c.innerText="Location";c.className=
"ms-gradient-label";e.appendChild(c);c=document.createElement("input");c.id=this.id+"color-stop-location";c.size=3;c.style.display="inline-block";c.style.width="35px";e.appendChild(c);c=document.createElement("div");c.innerText="%";c.style.display="inline-block";c.style.marginLeft="2px";c.style.marginRight="5px";e.appendChild(c);c=document.createElement("div");c.style.display="inline-block";c.style.width="45px";c.innerHTML="Delete";c.className="ms-gradient-button";c.addEventListener("click",function(n){this.deleteColorStop(n)}.bind(this));
e.appendChild(c);c=this.createTabs(["Preview","CSS","Layers","Import"]);c.id=this.id+"tab-container";$ms.addClass(c,"ms-gradient-tab-container");f.appendChild(c);f=document.createElement("div");f.id=this.id+"preview-outer";f.style.backgroundColor="rgb(240,240,240)";f.className="ms-gradient-css display-none";c.appendChild(f);g=document.createElement("div");g.appendChild(document.createTextNode("Enter dimensions."));g.className="ms-gradient-export-input";g.style.padding="0 5px";f.appendChild(g);d=document.createElement("table");
d.width="100%";a=document.createElement("tr");e=document.createElement("td");e.appendChild(document.createTextNode("Width: "));a.appendChild(e);e=document.createElement("td");var k=document.createElement("input");k.id=this.id+"export-width";k.value="200";k.size="8";e.appendChild(k);a.appendChild(e);d.appendChild(a);a=document.createElement("tr");e=document.createElement("td");e.appendChild(document.createTextNode("Height: "));a.appendChild(e);e=document.createElement("td");var p=document.createElement("input");
p.id=this.id+"export-height";p.size="8";p.value="200";e.appendChild(p);a.appendChild(e);d.appendChild(a);a=document.createElement("tr");e=document.createElement("td");e.colSpan=2;var h=document.createElement("div");h.innerHTML="Download PNG";h.className="ms-gradient-button";h.style.marginLeft="45px";h.style.display="inline-block";h.addEventListener("click",function(n){this.downloadPNG(this.aGradient,{width:k.value,height:p.value})}.bind(this));e.appendChild(h);a.appendChild(e);d.appendChild(a);g.appendChild(d);
d=document.createElement("div");d.id=this.id+"preview-wrapper";d.className="ms-gradient-preview-wrapper";f.appendChild(d);f=document.createElement("div");f.id=this.id+"preview-wrapper2";f.className="ms-cp-transparent-grid ms-gradient-preview-wrapper2";d.appendChild(f);d=document.createElement("div");d.id=this.id+"preview";d.className="ms-gradient-preview-inner";f.appendChild(d);f=document.createElement("div");f.id=this.id+"css-outer";f.className="ms-gradient-css display-none";c.appendChild(f);var m=
document.createElement("div");m.id=this.id+"css-text";m.className="ms-gradient-css-text";f.appendChild(m);d=document.createElement("div");d.innerHTML="Copy";d.className="ms-gradient-button ms-gradient-copy-button";d.style.width="40px";d.style.right="40px";d.addEventListener("click",function(n){n=m.innerHTML.replace(/<\/div><div>/g,"\n").replace(/<[^>]+>/g,"");$ms.copyToClipboard(n);$ms.removeClass($ms.$(this.id+"copy-status"),"display-none");setTimeout(function(){$ms.addClass($ms.$(this.id+"copy-status"),
"display-none")}.bind(this),1E3)}.bind(this));f.appendChild(d);d=document.createElement("div");d.innerHTML="RGB";d.className="ms-gradient-button ms-gradient-copy-button";d.style.width="40px";d.style.right="85px";d.addEventListener("click",function(n){this.cssMode="rgb";this.cssText.innerHTML=this.getCssText(this.cssMode)}.bind(this));f.appendChild(d);d=document.createElement("div");d.innerHTML="HSL";d.className="ms-gradient-button ms-gradient-copy-button";d.style.width="40px";d.style.right="130px";
d.addEventListener("click",function(n){this.cssMode="hsl";this.cssText.innerHTML=this.getCssText(this.cssMode)}.bind(this));f.appendChild(d);d=document.createElement("div");d.innerHTML="Hex";d.className="ms-gradient-button ms-gradient-copy-button";d.style.width="45px";d.style.right="175px";d.addEventListener("click",function(n){this.cssMode="hex";this.cssText.innerHTML=this.getCssText(this.cssMode)}.bind(this));f.appendChild(d);d=document.createElement("div");d.id=this.id+"copy-status";d.className=
"ms-gradient-copy-status display-none";d.innerHTML="Copied to Clipboard";f.appendChild(d);c.appendChild(f);f=document.createElement("div");f.id=this.id+"layers-outer";f.className="ms-gradient-layers-outer display-none";c.appendChild(f);e=document.createElement("div");e.id=this.id+"layers-listbox";e.className="ms-gradient-layers-listbox";f.appendChild(e);d=document.createElement("ul");d.id=this.id+"layer-ul";e.appendChild(d);e={scope:"layers",accept:"",append:"li.li-layer",noPosition:!0,insert:"",
classes:{active:""},cbDrop:this.updateFromDragDrop.bind(this)};$ms.droppable(d,e);e=document.createElement("div");e.className="ms-gradient-right-outer";b.appendChild(e);e=document.createElement("div");e.className="ms-gradient-layer-button-div";f.appendChild(e);d=document.createElement("div");d.innerHTML="Add Layer";d.className="ms-gradient-button ms-gradient-layer-button";d.style.display="inline-block";d.addEventListener("click",function(n){this.addLayer()}.bind(this));e.appendChild(d);d=document.createElement("div");
d.innerHTML="Delete Layer";d.className="ms-gradient-button ms-gradient-layer-button";d.style.display="inline-block";d.addEventListener("click",function(n){this.deleteLayer()}.bind(this));e.appendChild(d);d=document.createElement("div");d.id=this.id+"layers-preview-wrapper";d.className="ms-cp-transparent-grid ms-gradient-preview-wrapper";f.appendChild(d);f=document.createElement("div");f.id=this.id+"import-outer";f.style.backgroundColor="rgb(240,240,240)";f.className="ms-gradient-css display-none";
c.appendChild(f);var q=document.createElement("textarea");q.id=this.id+"import-text";q.placeholder="Enter a gradient string to import. Use Mozilla, Webkit, or W3C format: (e.g. linear-gradient(to top, rgb(0,0,0) 0%, rgba(255,0,0,0) 100%)";q.className="ms-gradient-css-text";q.style.resize="none";f.appendChild(q);c=document.createElement("div");c.innerHTML="Import";c.className="ms-gradient-button ms-gradient-copy-button";c.addEventListener("click",function(n){this.showGradientFromString(q.value)}.bind(this));
f.appendChild(c);e=document.createElement("div");e.className="ms-gradient-right-outer";b.appendChild(e);f=document.createElement("div");f.style.height="110px";e.appendChild(f);d=document.createElement("div");d.innerHTML="Ok";d.className="ms-gradient-button ms-cp-button";d.style.display="block";d.style.width="120px";d.addEventListener("click",function(n){this.save()}.bind(this));f.appendChild(d);d=document.createElement("div");d.innerHTML="Cancel";d.className="ms-gradient-button ms-cp-button";d.style.display=
"block";d.style.width="120px";d.addEventListener("click",function(n){this.cancel()}.bind(this));f.appendChild(d);c=document.createElement("div");c.style.display="inline-block";c.style.width="120px";f.appendChild(c);d=document.createElement("div");d.innerHTML="New";d.className="ms-gradient-button ms-cp-button";d.style.display="inline-block";d.style.width="53px";d.style.marginRight="11px";d.addEventListener("click",function(n){this.cpLibrary.colorDeselect();this.showGradientFromColor(this.settings.newGradient)}.bind(this));
c.appendChild(d);d=document.createElement("div");d.innerHTML="Undo";d.className="ms-gradient-button ms-cp-button";d.style.display="inline-block";d.style.width="53px";d.addEventListener("click",function(n){this.undoString&&this.showGradientFromString(this.undoString)}.bind(this));c.appendChild(d);d=document.createElement("div");d.id=this.id+"remove-gradient";d.innerHTML="Remove Gradient";d.className="ms-gradient-button ms-cp-button";d.title="Click to remove the current gradient and revert to a single color";
d.style.width="120px";d.addEventListener("click",function(n){this.remove(n)}.bind(this));f.appendChild(d);e.appendChild(this.cpLibrary.createForm());this.settings.container.appendChild(b);b.style.fontSize=$ms.targetFontSize(this.settings.fontSize,b);return b};l.prototype.deleteOpacityStop=function(){-1!=this.currStop&&this.deleteStop(this.cs[this.currStop].slider)};l.prototype.deleteColorStop=function(){-1!=this.currStop&&this.deleteStop(this.cs[this.currStop].slider)};l.prototype.colorStopsToSliders=
function(){var a,b,c;for(a=this.cs.length-1;0<=a;a--)for(var f=a-1;0<=f;f--)if(this.cs[a].rgbString===this.cs[f].rgbString&&parseInt(this.cs[a].position)==parseInt(this.cs[f].position)){this.cs.splice(a,1);break}for(var d=f=0,e=[],g=this.currStop=0;g<this.cs.length;g++){var k=c=!1;a=p;var p=this.cs[g];g<this.cs.length-1&&(b=this.cs[g+1]);if(0==g||3>this.cs.length)k=c=!0;else if(0<g&&g<this.cs.length-1){var h=a.position,m=b.position;c=b.rgb[0]-a.rgb[0];var q=b.rgb[1]-a.rgb[1],n=b.rgb[2]-a.rgb[2],r=
this.cs[g].position;k=p.alpha;var u=p.rgb[0],w=p.rgb[1],z=p.rgb[2];h=0==m-h?0:(r-h)/(m-h);k=$ms.round(h*(b.alpha-a.alpha)+a.alpha,2)!==$ms.round(k,2);c=!($ms.round(h*c+a.rgb[0],0)==u&&$ms.round(h*q+a.rgb[1],0)==w&&$ms.round(h*n+a.rgb[2],0)==z);k||c||(k=c=!0)}else g==this.cs.length-1&&(k=c=!0);if(c||!c&&!k)d++,this.cs[g].type="color";k&&(f++,c&&k?e.push({rgbString:this.cs[g].rgbString,position:this.cs[g].position,rgb:this.cs[g].rgb,alpha:this.cs[g].alpha,hex:this.cs[g].hex,slider:void 0,type:"opacity"}):
this.cs[g].type="opacity")}for(g=0;g<e.length;g++)this.cs.push(e[g]);this.cs.sort(function(A,B){return A.position-B.position});this.layerBusy=!0;for(g=0;g<this.cs.length;g++)this.addStop({position:this.cs[g].position,index:g,type:this.cs[g].type});this.layerBusy=!1;this.updateVisuals()};l.prototype.addStop=function(a){var b=$ms.$(this.id+a.type+"-bar");this.gradient||(this.gradient={});this.gradient.colorStop||(this.gradient.colorStop=[]);this.cs=this.gradient.colorStop;this.gradient.direction||(this.gradient.direction=
"to bottom",this.gradient.sideCorner="bottom");if(-1==this.barMousedownSet.indexOf(b.id)){this.barMousedownSet.push(b.id);var c=function(g,k){g=parseFloat(k.getValuesFromMousePosition(g).x);this.addStop({position:g,newFromPosition:!0,type:a.type,makeActive:!0});return!1}.bind(this)}var f=function(g,k){g.stopPropagation();g.preventDefault();this.selectStopSlider(k);this.deleteStopListener=function(){this.deleteStop(k)}.bind(this);"color"==k.colorStop.type?($ms.addClass(this.colorDelete,"ms-gradient-delete-bar"),
this.colorDelete.addEventListener("mousemove",this.deleteStopListener)):($ms.addClass(this.opacityDelete,"ms-gradient-delete-bar"),this.opacityDelete.addEventListener("mousemove",this.deleteStopListener));$ms.removeClass(k.bar,"ms-gradient-slider-bar");return!0}.bind(this);var d=function(g,k){g.stopPropagation();g.preventDefault();$ms.addClass(k.bar,"ms-gradient-slider-bar");"color"==k.colorStop.type?($ms.removeClass(this.colorDelete,"ms-gradient-delete-bar"),this.deleteStopListener&&this.colorDelete.removeEventListener("mousemove",
this.deleteStopListener)):($ms.removeClass(this.opacityDelete,"ms-gradient-delete-bar"),this.deleteStopListener&&this.opacityDelete.removeEventListener("mousemove",this.deleteStopListener))}.bind(this),e=function(g,k){g.stopPropagation();g.preventDefault();"color"==k.colorStop.type&&this.openColorPicker()}.bind(this);c={xMinValue:0,xMaxValue:100,yMinValue:1,yMaxValue:1,imgPath:this.settings.imgPath,arrowImage:void 0,sliderArrowClass:"ms-slider-arrow-"+("color"==a.type?"bottom":"top")+"-unselected",
container:$ms.$(this.id+a.type+"-bar"),direction:"horizontal",snapX:1,cbSliderBarMousedown:c,cbSliderArrowMousedown:f,cbSliderMouseup:d,cbSliderArrowDblclick:e,ignoreBarMousedown:"undefined"==typeof c};b=new $msRoot.Slider(b,c);c=document.createElement("div");c.id=this.id+"arrow-color";c.className="ms-slider-arrow-inner ms-slider-arrow-inner-"+a.type;b.arrow.appendChild(c);b.arrow.title=a.type.charAt(0).toUpperCase()+a.type.slice(1)+" Stop";b.arrowInner=c;c="color"==a.type?"opacity":"color";"undefined"!==
typeof a.colorValue?(c=$msRoot.colorMethods.colorInfo(a.colorValue),this.cs.push({rgbString:a.colorValue,position:a.position,rgb:c.rgb,alpha:c.alpha,hex:c.hex,slider:b,type:a.type}),a.index=this.cs.length-1):"undefined"!==typeof a.opacityValue?(c=this.valueFromPosition(a.position,c),this.cs.push({rgbString:c.rgbString,position:a.position,rgb:c.rgb,alpha:a.opacityValue,hex:c.hex,slider:b,type:a.type}),a.index=this.cs.length-1):"undefined"!==typeof a.index?this.cs[a.index].slider=b:typeof a.newFromPosition&&
(c=this.valueFromPosition(a.position,"any"),"color"==a.type&&"undefined"!==typeof this.lastDeletedStop.color?(f=c.alpha,c=$msRoot.colorMethods.colorInfo(this.lastDeletedStop.color.rgbString),c.alpha=f):"opacity"==a.type&&"undefined"!==typeof this.lastDeletedStop.opacity&&(c.alpha=this.lastDeletedStop.opacity.alpha),this.cs.push({rgbString:c.rgbString,position:a.position,rgb:c.rgb,alpha:c.alpha,hex:c.hex,slider:b,type:a.type}),a.index=this.cs.length-1);b.xValue=a.position;b.setArrowPositionFromValues();
b.colorStop=this.cs[a.index];"color"==a.type?b.arrowInner.style.backgroundColor="rgb("+b.colorStop.rgb[0]+","+b.colorStop.rgb[1]+","+b.colorStop.rgb[2]+")":(c=255*b.colorStop.alpha,b.arrowInner.style.backgroundColor="rgb("+c+","+c+","+c+")");a.makeActive&&(this.currStop=a.index,this.selectStopSlider(b));this.updateVisuals();b.onValuesChanged=function(g){this.gradientValuesChanged(g);this.updateVisuals()}.bind(this)};l.prototype.deleteStop=function(a){var b=this.getFilteredStopType(a.colorStop.type);
var c="color"==a.colorStop.type?this.colorDelete:this.opacityDelete;if(3>b.length)$ms.removeClass(c,"ms-gradient-delete-bar"),$ms.addClass(c,"ms-gradient-delete-bar-not-allowed"),setTimeout(function(){$ms.removeClass(c,"ms-gradient-delete-bar-not-allowed")}.bind(this),1E3);else{setTimeout(function(){$ms.removeClass(c,"ms-gradient-delete-bar")}.bind(this),1E3);c.removeEventListener("mousemove",this.deleteStopListener);this.lastDeletedStop[a.colorStop.type]={rgbString:a.colorStop.rgbString,alpha:a.colorStop.alpha};
for(b=0;b<this.cs.length;b++)if(this.cs[b].slider.id==a.id){this.cs.splice(b,1);break}$ms.addClass(a.bar,"ms-gradient-slider-bar");a.close();this.selectStopSlider();"opacity"==a.colorStop.type?this.recalcOpacityForColorStops():"color"==a.colorStop.type&&this.recalcColorForOpacityStops();this.updateVisuals()}};l.prototype.gradientValuesChanged=function(a){if(a||-1!=this.currStop){a||(a=this.cs[this.currStop].slider);var b=parseInt(a.xValue);a.colorStop.position=b;"opacity"==a.colorStop.type?(b=this.valueFromPosition(b,
"color"),a.colorStop.hex=b.hex,a.colorStop.rgb=b.rgb,a.colorStop.rgbString=$msRoot.colorMethods.rgbToRgba(b.rgb,a.colorStop.alpha),this.opacitySlider.xValue=this.opacityInput.value,this.opacitySlider.setArrowPositionFromValues(),this.recalcOpacityForColorStops()):"color"==a.colorStop.type&&(b=this.valueFromPosition(b,"opacity"),a.colorStop.alpha=b.alpha,a.colorStop.rgbString=$msRoot.colorMethods.rgbToRgba(a.colorStop.rgb,b.alpha),this.recalcColorForOpacityStops())}};l.prototype.recalcOpacityForColorStops=
function(){for(var a=this.getFilteredStopType("color"),b=0;b<a.length;b++){var c=this.valueFromPosition(a[b].position,"opacity");a[b].alpha=c.alpha;a[b].rgbString=$msRoot.colorMethods.rgbToRgba(a[b].rgb,c.alpha)}};l.prototype.recalcColorForOpacityStops=function(){for(var a=this.getFilteredStopType("opacity"),b=0;b<a.length;b++){var c=this.valueFromPosition(a[b].position,"color");a[b].hex=c.hex;a[b].rgb=c.rgb;a[b].rgbString=$msRoot.colorMethods.rgbToRgba(c.rgb,a[b].alpha)}};l.prototype.getFilteredStopType=
function(a){var b=this.cs.slice();b.sort(function(d,e){return d.position-e.position});if("any"==a)return b;for(var c=[],f=0;f<b.length;f++)b[f].type===a&&c.push(b[f]);return c};l.prototype.valueFromPosition=function(a,b){"undefined"==typeof b&&(b="any");var c=this.getFilteredStopType(b),f=0,d=0,e={alpha:1,rgb:[0,0,0]};b={alpha:1,rgb:[0,0,0]};for(var g=0;g<c.length;g++){if(+c[g].position==+a)return c[g];if(+c[g].position>+a){if(0==g)return c[g];d=c[g].position;e=c[g];break}else f=c[g].position,b=c[g]}var k=
parseFloat(b.alpha)-parseFloat(e.alpha);c=b.rgb[0]-e.rgb[0];g=b.rgb[1]-e.rgb[1];e=b.rgb[2]-e.rgb[2];var p=0;0<d-f&&(p=(a-f)/(d-f));a=$ms.round(b.alpha-p*k,2);b=[$ms.round(b.rgb[0]-p*c,0),$ms.round(b.rgb[1]-p*g,0),$ms.round(b.rgb[2]-p*e,0)];return $msRoot.colorMethods.colorInfo(b,a)};l.prototype.updateInputValuesFromStop=function(){if(-1!=this.currStop)if("opacity"==this.cs[this.currStop].type)this.opacityInput.value=parseInt(100*this.cs[this.currStop].alpha),this.opacityLocationInput.value=parseInt(this.cs[this.currStop].position),
this.colorInput.innerHTML="",this.colorInput.style.backgroundColor="",this.colorLocationInput.value="";else{var a=this.cs[this.currStop].rgb.slice();a.length=Math.min(3,this.cs[this.currStop].rgb.length);this.colorInput.style.backgroundColor="rgb("+a.join()+")";this.colorInput.InnerHTML="rgb("+a.join()+")";this.colorInput.style.color=$msRoot.colorMethods.highlightcolor(this.cs[this.currStop].rgb[0],this.cs[this.currStop].rgb[1],this.cs[this.currStop].rgb[2]);this.colorLocationInput.value=parseInt(this.cs[this.currStop].position);
this.opacityInput.value="";this.opacityLocationInput.value=""}};l.prototype.updateStopFromInputValues=function(){-1!=this.currStop&&"opacity"==this.cs[this.currStop].type&&(this.cs[this.currStop].alpha=this.opacityInput.value,this.gradientValuesChanged(),this.updateVisuals())};l.prototype.updateStopFromColor=function(a){if(-1<this.currStop){this.cs[this.currStop].rgbString=a.rgbString;this.cs[this.currStop].hex=a.hex;this.cs[this.currStop].rgb=a.rgb;for(var b=0;b<this.cs.length;b++)this.cs[b].position==
this.cs[this.currStop].position&&(this.cs[b].rgbString=a.rgbString,this.cs[b].hex=a.hex,this.cs[b].rgb=a.rgb)}};l.prototype.colorStopType=function(a){return-1==a?"":this.cs[a].type};l.prototype.updateVisuals=function(){this.updateArrows();if(!this.layerBusy&&-1!=this.currLayer){this.string=this.getGradientString(this.gradient);this.aGradient[this.currLayer].string=this.string;var a=this.getGradientString(this.gradient,"to right");a&&(this.allLayersString&&(this.undoString=this.allLayersString.noPrefix),
this.allLayersString=this.getGradientString(this.aGradient),this.setBackground($ms.$(this.id+"gradient-bar"),a),this.setBackground(this.preview,this.allLayersString),this.setBackground(this.aGradient[this.currLayer].li.firstChild.firstChild,a),this.cpLibrary.color={gradient:this.allLayersString.noPrefix},1==this.tab&&(this.cssText.innerHTML=this.getCssText(this.cssMode)),this.updateTarget(),this.settings.colorPicker&&!$ms.hasClass(this.settings.colorPicker.container,"display-none")&&this.settings.colorPicker.updateVisuals(!0))}};
l.prototype.getCssText=function(a){for(var b="",c="",f="",d="",e=0;e<this.aGradient.length;e++)if(0<e&&(b+=",",c+=",",f+=","),"rgb"==a)b+=this.aGradient[e].string.moz,c+=this.aGradient[e].string.webkit,f+=this.aGradient[e].string.noPrefix,0==e&&(d=this.aGradient[e].string.ie);else{var g=this.getGradientString(this.aGradient[e],void 0,a);b+=g.moz;c+=g.webkit;f+=g.noPrefix;0==e&&(d=g.ie)}return"<div>background: "+b+";</div><div>background: "+c+";</div><div>background: "+f+";</div><div>background: "+
d+";</div>"};l.prototype.updateArrows=function(){if(-1<this.currStop){var a=this.cs[this.currStop].slider;if("color"==a.colorStop.type)a.arrowInner.style.backgroundColor="rgb("+a.colorStop.rgb[0]+","+a.colorStop.rgb[1]+","+a.colorStop.rgb[2]+")";else{var b=255*a.colorStop.alpha;a.arrowInner.style.backgroundColor="rgb("+b+","+b+","+b+")"}this.updateInputValuesFromStop()}};l.prototype.setBackground=function(a,b){a.style.background=b.vendor};l.prototype.getGradientString=function(a,b,c){var f="",d="",
e="",g="",k;if(!a)return!1;a=Array.isArray(a)?a:[a];for(var p=0;p<a.length;p++){var h=a[p];0<f.length&&(f+=",",d+=",",e+=",",g+=",");if("undefined"==typeof b||0<p)b=h.direction;var m="top";switch(b){case "to bottom":m="top";break;case "to right":m="left";break;case "to top":m="bottom";break;case "to left":m="right";break;case "135deg":case "to top left":m="135deg";break;case "45deg":case "to top right":m="45deg";break;case "315deg":case "to bottom right":m="315deg";break;case "225deg":case "to bottom left":m=
"225deg";break;case "radial":m="radial";break;default:-1!==b.indexOf("degrees")?m=b=h.degrees+"deg":-1!==b.indexOf("deg")&&(m=b)}h=h.colorStop.slice();for(k=h.length-1;0<=k;k--)for(var q=k-1;0<=q;q--)if(h[k].rgbString===h[q].rgbString&&parseInt(h[k].position)==parseInt(h[q].position)){h.splice(k,1);break}h.sort(function(r,u){return r.position-u.position});k="";for(q=0;q<h.length;q++)if(c&&"rgb"!=c)if("hsl"==c){var n=$msRoot.colorMethods.rgbToHsl(h[q].rgb);k+=", "+n.hslString+" "+parseInt(h[q].position)+
"%"}else"hex"==c&&(k+=", "+h[q].hex+" "+parseInt(h[q].position)+"%");else k+=", "+h[q].rgbString+" "+parseInt(h[q].position)+"%";"radial"==b?(f+="radial-gradient(ellipse at center"+k+")",d+="-moz-radial-gradient(center, ellipse cover"+k+")",e+="-webkit-radial-gradient(center, ellipse cover"+k+")",m="to right"==b?"1":"0",k=h[0].hex,h=h[h.length-1].hex,0==p&&(g="filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='"+k+"', endColorstr='"+h+"',GradientType="+m+")")):(f+="linear-gradient("+
b+k+")",d+="-moz-linear-gradient("+m+k+")",e+="-webkit-linear-gradient("+m+k+")",m="to right"==b?"1":"0",k=h[0].hex,h=h[h.length-1].hex,0==p&&(g+="filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='"+k+"', endColorstr='"+h+"',GradientType="+m+")"));h="";switch(this.vendorFunctionPrefix){case "":h=f;break;case "-webkit-":h=e;break;case "-moz-":h=d}}return{noPrefix:f,moz:d,webkit:e,ie:g,vendor:h}};l.prototype.selectStopSlider=function(a){for(var b=0;b<this.cs.length;b++)$ms.removeClass(this.cs[b].slider.arrow,
"ms-slider-arrow-"+("color"==this.cs[b].slider.colorStop.type?"bottom":"top")+"-selected"),$ms.addClass(this.cs[b].slider.arrow,"ms-slider-arrow-"+("color"==this.cs[b].slider.colorStop.type?"bottom":"top")+"-unselected");if(a){for(b=0;b<this.cs.length;b++)if(this.cs[b].slider.id==a.id){this.currStop=b;break}$ms.addClass(a.arrow,"ms-slider-arrow-"+("color"==a.colorStop.type?"bottom":"top")+"-selected");"color"==a.colorStop.type?this.colorInputSelected():"opacity"==a.colorStop.type?this.opacityInputSelected():
this.disableAll()}else this.currStop=-1,this.disableAll()};l.prototype.getParsedGradient=function(a){var b=[],c=[];if(!a||0==a.length||-1==a.indexOf("gradient("))return[];var f=/(?:\s*)(?:linear|radial)-gradient\s*\(((?:\([^\)]*\)|[^\)\(]*)*)\)/g;for(var d;d=f.exec(a);)b.push(d[0]);if(0==b.length)return[];for(a=0;a<b.length;a++){f=b[a];if(0==f.length)break;-1==f.indexOf("to ")&&(f=f.replace("linear-gradient(","linear-gradient(to bottom, "));d=/\s*,\s*/;var e=/(?:[+-]?\d*\.?\d+)(?:%|[a-z]+)?/;var g=
v(["(?:",/#(?:[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/,"|","(?:rgb|hsl)",/\(\s*(?:[0-9]{1,3}\s*,\s*){1}\s*(?:[0-9]{1,3}(?:%)?\s*,\s*){1}[0-9]{1,3}(?:%)?\s*\)/,"|","(?:rgba|hsla)",/\(\s*(?:[0-9]{1,3}\s*,\s*){1}\s*(?:[0-9]{1,3}(?:%)?\s*,\s*){2}\s*(?:[0-9]{1,3}(?:%)?(?:[.][0-9]{1,3})?\s*)\)/,"|",/[_A-Za-z-][_A-Za-z0-9-]*/,")"],""),k=v([g,"(?:\\s+",e,")?"],"");k=v(["(?:",k,d,")*",k],"");var p=v(["(?:(",/(?:[+-]?\d*\.?\d+)(?:deg|grad|rad|turn)/,")|",/(?:to\s+)?((?:(?:left|right|top|bottom|ellipse at center|center, ellipse cover|)(?:\s+(?:top|bottom))?))/,
")"],"");k=v(["(",p,")",d,"(",k,")"],"gi");d=v(["\\s*(",g,")","(?:\\s+","(",e,"))?","(?:",d,"\\s*)?"],"gi");e={gradientSearch:k,colorStopSearch:d};d=/.*gradient\s*\(((?:\([^\)]*\)|[^\)\(]*)*)\)/.exec(f);if(null!==d){f=void 0;k=e.gradientSearch.exec(d[1]);if(null!==k)for(f={string:k[0],colorStop:[]},k[1]&&(f.direction=k[1],-1!==f.direction.indexOf("ellipse")||-1!==f.direction.indexOf("circle"))&&(f.direction="radial",f.radialDirection=k[1]),k[2]&&(f.angle=k[2]),k[3]&&(f.sideCorner=k[3]),g=e.colorStopSearch.exec(k[4]);null!==
g;)d={color:g[1]},g[2]&&(d.position=g[2]),f.colorStop.push(d),g=e.colorStopSearch.exec(k[4]);if(f){for(d=0;d<f.colorStop.length;d++)e=$msRoot.colorMethods.colorInfo(f.colorStop[d].color),delete f.colorStop[d].color,f.colorStop[d].position="undefined"!==typeof f.colorStop[d].position?f.colorStop[d].position.replace("%",""):1==f.colorStop.length?"100":""+d/(f.colorStop.length-1)*100,f.colorStop[d].hex=e.hex,f.colorStop[d].rgb=e.rgb,f.colorStop[d].rgba=e.rga,f.colorStop[d].alpha=e.alpha,f.colorStop[d].rgbString=
e.rgbString;c.push(f)}}}return c};var v=function(a,b){var c,f="";for(c=0;c<a.length;c++)f="string"===typeof a[c]?f+a[c]:f+a[c].source;return new RegExp(f,b)};l.prototype.updateGradientFromInput=function(){if("color"==this.colorStopType(this.currStop)){var a=$msRoot.colorMethods.rgbToHex(this.colorInput.innerHTML);this.updateCurrentStopFromHex(a)}else"opacity"==this.colorStopType(this.currStop)&&(this.cs[this.currStop].alpha=this.opacityInput.value/100);this.gradientValuesChanged();this.updateVisuals()};
l.prototype.updateCurrentStopFromHex=function(a){if(-1<this.currStop){a=$msRoot.colorMethods.colorInfo(a,this.cs[this.currStop].alpha);this.cs[this.currStop].rgbString=a.rgbString;this.cs[this.currStop].hex=a.hex;this.cs[this.currStop].rgb=a.rgb;for(var b=0;b<this.cs.length;b++)this.cs[b].position==this.cs[this.currStop].position&&(this.cs[b].rgbString=a.rgbString,this.cs[b].hex=a.hex,this.cs[b].rgb=a.rgb)}};l.prototype.setColor=function(a){this.showGradientFromString(a);this.settings.colorPicker&&
!$ms.hasClass(this.settings.colorPicker.container,"display-none")&&this.settings.colorPicker.hide()};l.prototype.colorInputSelected=function(a){if(a&&"color-input"==a&&$ms.hasClass(this.colorInput,"ms-disabled"))return!1;$ms.removeClass(this.colorInput,"ms-disabled");$ms.removeClass(this.colorLocationInput,"ms-disabled");this.colorLocationInput.removeAttribute("disabled");$ms.addClass(this.opacityInput,"ms-disabled");$ms.addClass(this.opacityLocationInput,"ms-disabled");this.opacityInput.disabled=
"disabled";this.opacityLocationInput.disabled="disabled";this.opacitySlider.disable();this.updateInputValuesFromStop();this.settings.colorPicker&&(this.updatingColorPicker=!0,this.settings.cbUpdateColorPicker(this.cs[this.currStop]),this.updatingColorPicker=!1);return!0};l.prototype.opacityInputSelected=function(a){a&&"opacity-input"==a&&$ms.hasClass(this.opacityInput,"ms-disabled")||($ms.removeClass(this.opacityInput,"ms-disabled"),$ms.removeClass(this.opacityLocationInput,"ms-disabled"),this.opacityLocationInput.removeAttribute("disabled"),
this.opacityInput.removeAttribute("disabled"),this.opacitySlider.enable(),this.opacityInput.value=parseInt(100*this.cs[this.currStop].alpha),this.opacitySlider.xValue=parseInt(100*this.cs[this.currStop].alpha),this.opacitySlider.setArrowPositionFromValues(),$ms.addClass(this.colorInput,"ms-disabled"),$ms.addClass(this.colorLocationInput,"ms-disabled"),this.colorLocationInput.disabled="disabled",this.updateInputValuesFromStop(),this.settings.colorPicker&&(this.settings.colorPicker.close(),this.settings.colorPicker=
void 0))};l.prototype.disableAll=function(){$ms.addClass(this.colorInput,"ms-disabled");$ms.addClass(this.colorLocationInput,"ms-disabled");this.colorLocationInput.disabled="disabled";$ms.addClass(this.opacityInput,"ms-disabled");$ms.addClass(this.opacityLocationInput,"ms-disabled");this.opacityLocationInput.disabled="disabled";this.opacitySlider.disable();this.cbDisable&&this.cbDisable()};l.prototype.opacityInputKeyup=function(a){-1!=this.currStop&&"color"!=this.cs[this.currStop].type&&""!=a.target.value&&
(this.opacityValueChanged(a.target),this.opacityInputSelected("opacity-input"))};l.prototype.opacityInputBlur=function(a){-1!=this.currStop&&"color"!=this.cs[this.currStop].type&&""==a.target.value&&this.opacityValueChanged(a.target)};l.prototype.opacityLocationKeyup=function(a){-1!=this.currStop&&"color"!=this.cs[this.currStop].type&&(this.locationChanged(a.target),this.opacityInputSelected("opacity-input"))};l.prototype.opacityLocationBlur=function(a){-1!=this.currStop&&"color"!=this.cs[this.currStop].type&&
""==a.target.value&&this.locationChanged(a.target)};l.prototype.colorLocationKeyup=function(a){-1!=this.currStop&&"opacity"!=this.cs[this.currStop].type&&-1!=this.currStop&&(this.locationChanged(a.target),this.colorInputSelected("color-input"))};l.prototype.colorLocationBlur=function(a){-1!=this.currStop&&"opacity"!=this.cs[this.currStop].type&&""==a.target.value&&this.locationChanged(a.target)};l.prototype.keydown=function(a,b,c,f){-1==this.currStop||-1!==a.target.id.indexOf("color")&&"opacity"==
this.cs[this.currStop].type||-1!==a.target.id.indexOf("opacity")&&"color"==this.cs[this.currStop].type||(38==a.keyCode?"undefined"!=typeof b&&(""==a.target.value&&(a.target.value=b),a.target.value=Math.min(parseInt(a.target.value)+1,c),f&&f.call(this,a),a.stopPropagation()):40==a.keyCode?"undefined"!=typeof b&&(""==a.target.value&&(a.target.value=b),a.target.value=Math.max(parseInt(a.target.value)-1,b),f&&f.call(this,a),a.stopPropagation()):f&&f.call(this,a))};l.prototype.opacityValueChanged=function(){var a=
parseInt(this.opacityInput.value);0==a&&""+a!==this.opacityInput.value&&(a=100);if(0>a||100<a)a=100;this.opacityInput.value=a;this.opacitySlider.xValue=this.opacityInput.value;this.opacitySlider.setArrowPositionFromValues();this.cs[this.currStop].alpha=a/100;this.gradientValuesChanged();this.updateVisuals()};l.prototype.locationChanged=function(a){var b=parseInt(a.value);0==b&&""+b!==a.value||0>b||100<b||isNaN(b)||(this.cs[this.currStop].position=b,this.cs[this.currStop].slider.xValue=b,this.cs[this.currStop].slider.setArrowPositionFromValues(),
this.gradientValuesChanged(this.cs[this.currStop].slider),this.updateVisuals())};l.prototype.positionArrows=function(){for(var a=0;a<this.cs.length;a++)this.cs[a].slider.setPositioningVariables();this.opacitySlider.setArrowPositionFromValues()};l.prototype.drop=function(a){for(var b=0;b<this.cs.length;b++)this.cs[b].slider.setPositioningVariables();"boolean"==typeof a&&a||this.settings.colorPicker&&!$ms.hasClass(this.settings.colorPicker,this.settings.colorPicker.isPinned)&&this.settings.colorPicker.drop(!0)};
l.prototype.createTabs=function(a){var b=this,c=document.createElement("div");c.id=this.id+"tab-container";c.className="ms-tabs ms-gradient-tabs";c.style.position="relative";c.backgroundColor="rgb(230,230,230)";var f=document.createElement("ul");f.id=this.id+"tab-ul";f.className="tab-primary";c.appendChild(f);for(var d=0;d<a.length;d++){var e=document.createElement("li");e.id=this.id+"tab-"+d;e.innerHTML=a[d];!function(g){e.addEventListener("click",function(k){b.showTab(g)},!1)}(d);0==d&&(e.className=
"tab-current");f.appendChild(e)}return c};l.prototype.showTab=function(a){for(var b,c=0;c<this.tabsContainer.childNodes.length;c++)if("UL"==this.tabsContainer.childNodes[c].nodeName){b=this.tabsContainer.childNodes[c];break}for(c=0;c<b.childNodes.length;c++)c==a?$ms.addClass(b.childNodes[c],"tab-current"):$ms.removeClass(b.childNodes[c],"tab-current");$ms.addClass(this.previewOuter,"display-none");$ms.addClass(this.cssOuter,"display-none");$ms.addClass(this.layersOuter,"display-none");$ms.addClass(this.importOuter,
"display-none");this.tab=a;0==a?($ms.removeClass(this.previewOuter,"display-none"),this.previewWrapper2.appendChild(this.preview),this.resizePreview()):1==a?(this.cssText.innerHTML=this.getCssText(this.cssMode),$ms.removeClass(this.cssOuter,"display-none")):2==a?($ms.removeClass(this.layersOuter,"display-none"),this.layersPreviewWrapper.appendChild(this.preview)):3==a&&($ms.removeClass(this.importOuter,"display-none"),this.layersPreviewWrapper.appendChild(this.preview))};l.prototype.colorLibResize=
function(a){"close"==a?setTimeout(function(){$ms.removeClass(this.tabsContainer,"ms-gradient-tab-container-narrow")}.bind(this),250):$ms.addClass(this.tabsContainer,"ms-gradient-tab-container-narrow")};l.prototype.save=function(){this.close(!0)};l.prototype.cancel=function(a){this.settings.startColor&&-1!==this.settings.startColor.indexOf("gradient")?this.showGradientFromString(this.settings.startColor):this.string=void 0;this.settings.target&&this.updateTarget(!0);this.close(!0)};l.prototype.remove=
function(){this.settings.colorPicker&&(this.settings.colorPicker.close(),this.settings.colorPicker=void 0);this.settings.target&&(this.string=void 0,this.updateTarget());this.openColorPicker(!0);this.close(!1)};l.prototype.resetSliders=function(){if(this.gradient)for(var a=0;a<this.cs.length;a++)this.cs[a].slider.arrowInner.parentNode.removeChild(this.cs[a].slider.arrowInner),this.cs[a].slider.close()};l.prototype.close=function(a){document.body.removeEventListener("DOMAttrModified",this.resize);
this.container.parentNode&&this.container.parentNode.removeChild(this.container);for(var b=0;b<t.length;b++)if(t[b].id==this.id){t.splice(b,1);break}this.opacitySlider.close();this.cpLibrary.close();$msRoot.CustomDialog.closeDialogs(this.id);if(this.cs)for(b=0;b<this.cs.length;b++)this.cs[b].slider.close();this.settings.colorPicker&&(this.settings.colorPicker.settings.gradient=void 0,a&&this.settings.colorPicker.close());this.observer.disconnect();if(this.settings.cbClose)if(Array.isArray(this.settings.cbClose))for(b=
0;b<this.settings.cbClose.length;b++)this.settings.cbClose[b](this);else this.settings.cbClose(this)};l.prototype.openColorPicker=function(a){-1==this.currStop&&(this.currStop=0);var b=this.cs[this.currStop].rgbString;if(!this.settings.colorPicker){var c=$ms.getOffset(this.container);this.settings.colorPicker=new $msRoot.ColorPicker({startColor:a?this.settings.startColor:b,startMode:"h",startPos:a?{top:c.top,left:c.left}:{top:"10px",left:"20px"},target:a?this.settings.target:void 0,cbChange:a?this.settings.cbChange:
void 0,cbCreate:a?this.settings.cbCreate:void 0,cbClose:a?this.settings.cbClose:void 0,imgPath:this.settings.imgPath,container:this.settings.container,zIndex:this.settings.zIndex+1,pin:!0,startPinned:a?!1:this.settings.pinColorPicker,gradient:a?void 0:this,fromGradientStartColor:a?b:void 0,cbUpdateGradientFromColor:a?void 0:function(f,d){this.cbUpdateGradientFromColor(f,d)}.bind(this)});this.settings.cbUpdateColorPicker=this.settings.colorPicker.cbUpdateColorPicker.bind(this.settings.colorPicker)}this.settings.cbUpdateColorPicker(this.cs[this.currStop]);
this.container.style.zIndex=this.settings.zIndex;this.settings.colorPicker.show(this.settings.zIndex+1)};l.prototype.cbUpdateGradientFromColor=function(a){-1==this.currStop||this.updatingColorPicker||"color"!==this.colorStopType(this.currStop)||(this.updateStopFromColor(a),this.gradientValuesChanged(),this.updateVisuals())};l.prototype.updateTarget=function(a){if(this.settings.target)try{for(var b=0;b<this.settings.target.length;b++){var c=this.settings.target[b];if(this.string){if(this.setBackground(c.element,
this.allLayersString),c.valueAttribute){c.element[c.valueAttribute]=this.allLayersString.noPrefix;var f="contrast"==c.textColor?$msRoot.colorMethods.highlightcolor(this.cs[0].rgb[0],this.cs[0].rgb[1],this.cs[0].rgb[2]):this.cs[0].rgbString;c.element.style.color=f}}else a&&0<this.settings.startColor.length?(c.element.style.removeProperty("background-image"),c.element.style.backgroundColor=this.settings.startColor,c.valueAttribute&&(c.element[c.valueAttribute]=this.settings.startColor)):(c.element.style.removeProperty("background-image"),
c.element.style.removeProperty("background-color"),c.valueAttribute&&(c.element[c.valueAttribute]=""))}"undefined"!==typeof this.settings.cbChange&&this.settings.cbChange(this,this.string)}catch(d){console.log("Gradient.updateTarget: "+d.message)}};l.prototype.selectLayer=function(a,b){for(var c=0;c<this.aGradient.length;c++)$ms.removeClass(this.aGradient[c].li,"ms-gradient-layer-selected");$ms.addClass(a,"ms-gradient-layer-selected");if(b)for(c=0;c<this.aGradient.length;c++)if(this.aGradient[c].li.id==
a.id){this.resetSliders();this.currLayer=c;this.gradient=this.aGradient[c];this.string=this.gradient.string;this.direction.value=this.gradient.direction;this.cs=this.gradient.colorStop;this.colorStopsToSliders();for(a=0;c<this.cs.length;a++)if("color"==this.cs[a].type){this.currStop=a;this.selectStopSlider(this.cs[a].slider);break}$ms.removeClass(this.container,"display-none");this.positionArrows();this.currLayer=c;break}};l.prototype.addLayer=function(){this.showGradientFromString(this.settings.newLayer,
!0);this.updateVisuals()};l.prototype.deleteLayer=function(){-1!=this.currLayer&&(this.layersUl.removeChild(this.aGradient[this.currLayer].li),this.aGradient.splice(this.currLayer,1),0==this.aGradient.length?this.showGradientFromString(this.settings.newLayer,!0):(this.currLayer>this.aGradient.length-1&&(this.currLayer=this.aGradient.length-1),this.selectLayer(this.aGradient[this.currLayer].li,!0),this.updateVisuals()))};l.prototype.degreesDialog=function(){"undefined"==typeof this.aGradient[this.currLayer].degrees&&
""==this.aGradient[this.currLayer].degrees;var a={id:this.id,dialogTitle:"Angle",text:"Enter the number of degrees",buttons:[{label:"Ok",enterKey:!0,cb:function(b){this.degreesDialogOpen=!1;b&&this.degreesChange(b.settings.input.element.value)}.bind(this)},{label:"Cancel",escapeKey:!0,title:"Do not load the gradient",cb:function(b){this.degreesDialogOpen=!1;this.direction.value="to bottom";this.gradient.direction=this.direction.value;this.gradient.degrees="";this.updateVisuals()}.bind(this)}],input:{label:"Angle: ",
value:this.aGradient[this.currLayer].degrees,onkeydown:function(b){this.keydown(b,0,360,this.degreesChange)}.bind(this),onkeyup:function(b){this.degreesChange(b)}.bind(this)}};dialog=new $msRoot.CustomDialog(a);this.degreesDialogOpen=!0};l.prototype.degreesChange=function(a){"object"==typeof a&&(a=a.target.value);a=this.validateDegrees(a);""===a?(this.direction.value="to bottom",this.gradient.direction=this.direction.value,this.gradient.degrees=""):(this.direction.value=this.addDegreeComboOption(a),
this.gradient.direction=this.direction.value,this.gradient.degrees=a);this.updateVisuals()};l.prototype.validateDegrees=function(a){a=parseInt(a.replace("degrees: ","").trim());return isNaN(parseInt(a))||360<a||0>a?"":a};l.prototype.updateFromDragDrop=function(a,b,c,f){for(b=0;b<this.layersUl.childNodes.length;b++)if(a.id==this.layersUl.childNodes[b].id){var d=b;break}for(b=0;b<this.aGradient.length;b++)if(a.id==this.aGradient[b].li.id){var e=b;break}"undefined"==typeof d||"undefined"==typeof e?console.log("Gradient drag drop - cannot find element"):
d!=e&&($ms.arrayMove(this.aGradient,e,d),this.selectLayer(this.aGradient[d].li,!0),this.updateVisuals())};l.prototype.resizePreview=function(){if(0===this.tab){var a=!1,b=this.previewWidth.value,c=this.previewHeight.value,f=$ms.getOffset(this.previewWrapper).width-2,d=$ms.getOffset(this.previewWrapper).height-2;if(isNaN(b)||isNaN(c))a=!0;a?(this.previewWrapper2.style.removeProperty("width"),this.previewWrapper2.style.removeProperty("height")):(a=b/c,0<a?(this.previewWrapper2.style.removeProperty("width"),
b=Math.min(f,b),c=b/a,c>d&&(c=d,b=c*a)):(this.previewWrapper2.style.removeProperty("height"),c=Math.min(d,c),b=c*a,b>f&&(b=f,c=b/a)),this.previewWrapper2.style.width=b+"px",this.previewWrapper2.style.height=c+"px")}};l.prototype.directionToAngle=function(a){var b=90;switch(a){case "to bottom":b=270;break;case "to right":b=0;break;case "to top":b=90;break;case "to left":b=180;break;case "135deg":case "to top left":b=135;break;case "45deg":case "to top right":b=45;break;case "315deg":case "to bottom right":b=
315;break;case "225deg":case "to bottom left":b=225;break;case "radial":b="radial";break;default:-1!==a.indexOf("deg")&&(b=parseInt(a))}return b};l.prototype.angleToDirection=function(a){a=parseInt(""+a);var b="to bottom";if(isNaN(a))return b;switch(a){case 270:b="to bottom";break;case 0:b="to right";break;case 90:b="to top";break;case 180:b="to left";break;case 135:b="to top left";break;case 45:b="to top right";break;case 315:b="to bottom right";break;case 225:b="to bottom left";break;default:b=
!1}return b};l.prototype.downloadPNG=function(a,b){if(!a)return!1;var c=Array.isArray(a)?a:[a];b.width=parseInt(b.width);if(isNaN(b.width)||0==b.width)b.width=200;b.height=parseInt(b.height);if(isNaN(b.height)||0==b.height)b.height=200;var f=document.createElement("canvas");f.id=this.id+"canvas";for(var d=!1,e=0;e<c.length;e++)if("radial"==this.directionToAngle(c[e].direction))d=!0;else if(d){d=!1;break}if(d){var g=b.width;var k=b.height;b.width=Math.max(b.width,b.height);b.height=Math.max(b.width,
b.height);f.width=Math.max(b.width,b.height);f.height=Math.max(b.width,b.height)}else f.style.width=b.width+"px",f.style.height=b.height+"px",f.width=b.width,f.height=b.height;a=f.getContext("2d");for(var p=c.length-1;0<=p;p--){var h=c[p];var m=h.colorStop.slice();for(e=m.length-1;0<=e;e--)for(var q=e-1;0<=q;q--)if(m[e].rgbString===m[q].rgbString&&parseInt(m[e].position)==parseInt(m[q].position)){m.splice(e,1);break}m.sort(function(r,u){return r.position-u.position});h=this.directionToAngle(h.direction);
"radial"==h?(h={x1:0,y1:0,x2:0,y2:0},h.x1=b.width/2,h.x2=h.x1,h.y1=b.height/2,h.y2=h.y1,h.r1=0,h.r2=Math.min(b.height,b.width),h=a.createRadialGradient(h.x1,h.y1,h.r1,h.x2,h.y2,h.r2),e=g/k,1<e?a.scale(1/e,1):1>e&&a.scale(e,1)):(h=this.cssAngleToCanvasCoords(b.width,b.height,h),h=a.createLinearGradient(h.x1,h.y1,h.x2,h.y2));for(e=0;e<m.length;e++){var n=m[e].rgbString;q=m[e].position/100;h.addColorStop(q,n);a.fillStyle=h}a.fillRect(0,0,f.width,f.height)}d&&(b=a.getImageData(0,0,g,k),a.canvas.width=
g,a.canvas.height=k,a.putImageData(b,0,0));(function(r,u){if(navigator.msSaveBlob)return r=r.msToBlob(),navigator.msSaveBlob(r,u);var w=r.toDataURL("image/png");r=document.createElement("a");r.download=u;r.href=w;document.body.appendChild(r);r.click?r.click():(u=document.createEvent("MouseEvents"),u.initMouseEvent("click",!0,!0,window),r.dispatchEvent(u));document.body.removeChild(r)})(f,"gradient.png");f=void 0};l.prototype.cssAngleToCanvasCoords=function(a,b,c){c/=180/Math.PI;if(function(g,k,p){k=
Math.atan2(p,k);return g<k||Math.abs(g-2*Math.PI)<k}(c,a,b)){var f="right";var d=a/2;var e=a/2*Math.tan(c)}else Math.abs(c-Math.PI/2)<Math.atan2(a,b)?(f="top",d=-b/2*Math.tan(c-Math.PI/2),e=b/2):Math.abs(c-Math.PI)<Math.atan2(b,a)?(f="left",d=-a/2,e=-a/2*Math.tan(c-Math.PI)):Math.abs(c-3*Math.PI/2)<Math.atan2(a,b)&&(f="bottom",d=b/2*Math.tan(c-3*Math.PI/2),e=-b/2);return function(g,k,p,h){var m=h.x;var q=h.y;if("right"==p){var n=0;var r=k-h.y}else"top"==p?(n=g-h.x,r=k):"left"==p?(n=g,r=k-h.y):"bottom"==
p&&(n=g-h.x,r=0);return{x1:n,y1:r,x2:m,y2:q}}(a,b,f,{x:d+a/2,y:-1*(e-b/2)})};return l}();
