
$msRoot.createNS("DragDrop");$msRoot.DragDrop=(function(){var b=[{file:"draggable.min.js",ns:"Draggable"},{file:"droppable.min.js",ns:"Droppable"},];$ms.sourceFiles.add(b);$ms.sourceFiles.load();var d=0;var a=[];var e={element:undefined,target:"",className:"",dropEffect:"",effectAllowed:""};function c(){this.id="DragDrop-"+d++;a.push({id:this.id,instance:this});this.dragStartListeners=[];this.dragEnterListeners=[];this.dragOverListeners=[];this.dragLeaveListeners=[];this.dropListeners=[];this.dragEndListeners=[];this.grid={x:1,y:1};this.currentDraggable;this.dragElementId="";this.noListener=false;this.draggable=[];this.droppable=[];this.startOffset={x:0,y:0};this.lastDragOver=Object.assign({},e);if(a.length>0){for(var f=0;f<a.length;f++){if(a[f].id==this.id){return a[f].instance}}}}c.prototype.registerDraggable=function(f){this.draggable.push(f)};c.prototype.registerDroppable=function(f){this.droppable.push(f)};c.prototype.registerDragStart=function(g){if(typeof g=="undefined"){g=document}if(this.listenerSet(this.dragStartListeners,g)){return}var f=function(k){var i=this.getElementItem(k.target,this.draggable,true);if(!i){k.preventDefault();k.stopPropagation();return}this.currentDraggable=i;k.dataTransfer.setData("Text",i.element.id);this.lastDragOver=Object.assign({},e);this.noListener=i.settings.scope=="default";var l=$ms.getOffset(i.settings.element);var h=i.settings.element.parentNode?i.settings.element.parentNode.id:undefined;i.settings.startInfo={x:l.x,y:l.y,left:i.settings.element.style.left,top:i.settings.element.style.top,parentNodeId:h};if(i.settings.cbDragStart=="function"){if(!i.settings.cbDragStart(k.target,i)){return}}this.startOffset.x=parseInt(k.offsetX);this.startOffset.y=parseInt(k.offsetY);this.registerListeners(k,i);var j=this.testSetDragImage();if(j){if(i.settings.handle){k.dataTransfer.setDragImage(i.settings.element,k.offsetX,k.offsetY)}else{k.dataTransfer.setDragImage(i.element,k.offsetX,k.offsetY)}}k.dataTransfer.effectAllowed="move"}.bind(this);if(g.nodeName.toLowerCase()=="#document"||g.nodeName.toLowerCase()=="body"){g.addEventListener("dragstart",f,false)}};c.prototype.registerDragEnter=function(g,f,i){if(this.listenerSet(this.dragEnterListeners,g)){return}var h=function(j){this.dragOverFn(j)}.bind(this);if(g.nodeName.toLowerCase()=="#document"||g.nodeName.toLowerCase()=="body"){g.addEventListener("dragenter",h,false)}this.dragEnterListeners.push({element:g,cb:f,listener:h,settings:i})};c.prototype.registerDragOver=function(g,f,i){if(this.listenerSet(this.dragOverListeners,g)){return}var h=function(j){this.dragOverFn(j)}.bind(this);if(g.nodeName.toLowerCase()=="#document"||g.nodeName.toLowerCase()=="body"){g.addEventListener("dragover",h,false)}this.dragOverListeners.push({element:g,cb:f,listener:h,settings:i})};c.prototype.dragOverFn=function(l){l.preventDefault();l.stopPropagation();var g=this.currentDraggable.element;var i=true;var f;if(this.clone){var m=this.calcClonePosition(l);this.clone.style.left=m.x+"px";this.clone.style.top=m.y+"px"}var k=l.target;var j=this.getListener(k,this.dropListeners);if(this.noListener){return}if(!j||j.element.id==g.id){while(f=this.getUnderTarget(l,k,this.dropListeners)){k=f.element;j=f.listener;if(k.id!==g.id){break}}if(!f){if(l.target.nodeName.toLowerCase()!=="body"){}i=false}}if(l.target===this.lastDragOver.element){l.dataTransfer.dropEffect=this.lastDragOver.dropEffect;l.dataTransfer.effectAllowed=this.lastDragOver.effectAllowed;return}if(this.lastDragOver.className){$ms.removeClass(this.lastDragOver.target,this.lastDragOver.className)}var h="";if(i){l.dataTransfer.dropEffect="move";l.dataTransfer.effectAllowed="all";if(!j){if(k.nodeName.toLowerCase()!=="body"){console.log("dragOverFn - Couldn't find listener for "+k.id)}}else{if(g.id==k.id){console.log("over self")}else{if((j.settings.classes.active&&typeof l.target.classList)=="object"){h=j.settings.classes.active;$ms.addClass(k,h)}}}if(typeof j.settings.cbDragOver=="function"){j.settings.cbDragOver(g,this.currentDraggable,j)}}else{l.dataTransfer.dropEffect="none";l.dataTransfer.effectAllowed="none"}this.lastDragOver.element=l.target;this.lastDragOver.target=k;this.lastDragOver.dropEffect=l.dataTransfer.dropEffect;this.lastDragOver.effectAllowed=l.dataTransfer.effectAllowed;this.lastDragOver.className=h};c.prototype.registerDragLeave=function(h,f,i){if(this.listenerSet(this.dragLeaveListeners,h)){return}var g=function(k){var j=this.getListener(k.target,this.dragLeaveListeners);if(j&&typeof j.settings.cbDragLeave=="function"){j.settings.cbDragLeave(k.target,j.settings)}if(this.lastDragOver.className){}}.bind(this);if(h.nodeName.toLowerCase()=="#document"||h.nodeName.toLowerCase()=="body"){h.addEventListener("dragleave",g,false)}this.dragLeaveListeners.push({element:h,cb:f,listener:g,settings:i})};c.prototype.registerDrop=function(g,f,h){if(this.listenerSet(this.dropListeners,g)){return}var i=function(j){this.dropFn(j)}.bind(this);if(g.nodeName.toLowerCase()=="#document"||g.nodeName.toLowerCase()=="body"){g.addEventListener("drop",i,false)}this.dropListeners.push({element:g,cb:f,listener:i,settings:h})};c.prototype.dropFn=function(z){z.stopPropagation();z.preventDefault();var h=this.currentDraggable.element;var j=this.currentDraggable;var C=true;var y;var D=z.target;if(this.lastDragOver.className){$ms.removeClass(this.lastDragOver.element,this.lastDragOver.className)}var k=this.getListener(D,this.dropListeners);if(!this.noListener&&(!k||k.element.id==h.id)){while(y=this.getUnderTarget(z,D,this.dropListeners)){D=y.element;if(D.id!==h.id){break}}if(!y){C=false}}var G;if(this.noListener){G={settings:{}}}else{if(C){G=this.getElementItem(D,this.droppable,false);if(!G){while(y=this.getUnderTarget(z,D,this.dropListeners)){D=y.element;if(G=this.getElementItem(D,this.droppable,false)){break}}if(!G){console.log("drop - could not find droppable");C=false}}}}var B=G.settings.noPosition;var p=j.settings.element;if(this.noListener){}else{if(C&&j.settings.revert!==true){if(G.settings.append.length>0&&p.matches(G.settings.append)){D.appendChild(p);if(D.style.display=="flex"){var A=-1;for(var v=0;v<D.childNodes.length;v++){if(typeof D.childNodes[v].style=="undefined"){continue}if(D.childNodes[v].isSameNode(p)){continue}var u=parseInt(D.childNodes[v].style.order);if(!isNaN(u)){A=Math.max(u,A)}}u=parseInt(p.style.order);if(A>-1){p.style.order=A+1;p.style.top="";p.style.left="";B=true}else{if(!isNaN(u)){p.style.order=0;p.style.top="";p.style.left="";B=true}}}}else{if(G.settings.insert.length>0&&p.matches(G.settings.insert)){D.parentNode.insertBefore(p,D);p.style.top="";p.style.left="";B=true;if(D.parentNode.style.display=="flex"&&D.style.order.length>0){var n=parseInt(D.style.order);if(!isNaN(n)){for(var v=0;v<D.parentNode.childNodes.length;v++){if(typeof D.parentNode.childNodes[v].style=="undefined"){continue}var u=parseInt(D.parentNode.childNodes[v].style.order);if(!isNaN(u)&&u>=n){D.parentNode.childNodes[v].style.order=u+1}}p.style.order=n}}}}}}var E=getComputedStyle(p).getPropertyValue("position");var l=$ms.getOffset(p.offsetParent);var w=this.startOffset.y+l.y;var x=this.startOffset.x+l.x;if(C&&j.settings.revert!==true){if(!B){if(this.containment){if(E=="absolute"||E=="relative"){var f=$ms.getOffset(this.containment);var r=f.top;var q=f.left;var l=$ms.getOffset(p.offsetParent);var m=r+parseFloat(this.clone.style.top);var o=m-l.y;var g=q+parseFloat(this.clone.style.left);var s=g-l.x;p.style.top=(Math.round(o/this.grid.y)*this.grid.y)+"px";p.style.left=(Math.round(s/this.grid.x)*this.grid.x)+"px"}}else{if(E=="absolute"){p.style.top=(Math.round((z.pageY-w)/this.grid.y)*this.grid.y)+"px";p.style.left=(Math.round((z.pageX-x)/this.grid.x)*this.grid.x)+"px"}else{if(E=="relative"){p.style.top=(Math.round((z.pageY-w)/this.grid.y)*this.grid.y)+"px";p.style.left=(Math.round((z.pageX-x)/this.grid.x)*this.grid.x)+"px"}}}}this.removeClone();this.removeContainment();p.style.visibility="";if(typeof G.settings.cbDrop=="function"){G.settings.cbDrop(p,G.settings.element,j.settings,G.settings)}if(typeof j.settings.cbDrop=="function"){j.settings.cbDrop(p,G.settings.element,j.settings,G.settings)}}else{if(j.settings.revert=="invalid"||j.settings.revert===true){if(E=="absolute"||E=="relative"){var F={x:(Math.round((z.pageX-x)/this.grid.x)*this.grid.x),y:(Math.round((z.pageY-w)/this.grid.y)*this.grid.y)};var f=$ms.getOffset(p);var t={x:f.left,y:f.top};this.revert(p,F,t)}}}return false};c.prototype.testSetDragImage=function(){var f=window.DataTransfer||window.Clipboard;if("setDragImage" in f.prototype){return true}else{return false}};c.prototype.registerDragEnd=function(i,f,h){if(typeof i=="undefined"){i=document}var g=function(j){this.dragEndFn(j,f,h)}.bind(this);if(i.nodeName.toLowerCase()=="#document"||i.nodeName.toLowerCase()=="body"){i.addEventListener("dragend",g,false)}this.dragEndListeners.push({element:i,cb:f,listener:g,settings:h})};c.prototype.dragEndFn=function(h,f,g){setTimeout(function(){this.dragEndFn2(h,f,g)}.bind(this),50)};c.prototype.dragEndFn2=function(j,g,h){var i=this.getListener(j.target,this.dragEndListeners);if(i&&typeof i.settings.cbDragEnd=="function"){i.settings.cbDragEnd(j.target,i.settings)}if(this.dragOverListeners.length==0){return}this.removeListeners("dragenter",this.dragEnterListeners);this.removeListeners("dragover",this.dragOverListeners);this.removeListeners("dragleave",this.dragLeaveListeners);this.removeListeners("drop",this.dropListeners);this.removeListeners("dragend",this.dragEndListeners);var f=this.getElementItem(j.target,this.draggable,true);this.removeClone();this.removeContainment();if(this.lastDragOver.className){$ms.removeClass(this.lastDragOver.element,this.lastDragOver.className)}f.settings.element.style.visibility=""};c.prototype.getUnderTarget=function(m,h,j){if(h.nodeName.toLowerCase()=="body"){return false}try{h.style.visibility="hidden"}catch(m){return false}var g,n,l;var k=[h];while(g=document.elementFromPoint(m.pageX,m.pageY)){if(l=this.getListener(g,j)){n=g;break}else{if(g.nodeName=="BODY"){break}else{k.push(g);g.style.visibility="hidden"}}}for(var f=0;f<k.length;f++){k[f].style.visibility=""}if(!n){return false}return{element:n,listener:l}};c.prototype.getListener=function(g,h){for(var f=0;f<h.length;f++){if(h[f].element.id&&h[f].element.id==g.id){return h[f]}}return false};c.prototype.getElementItem=function(h,k,g){if(g&&(!h.getAttribute||!h.getAttribute("draggable"))){var j=h.parentNode;var g=false;while(j&&j.getAttribute){if(g=j.getAttribute("draggable")){h=j;break}j=j.parentNode}if(!g){return false}}for(var f=0;f<k.length;f++){if(k[f].element.id&&k[f].element.id==h.id){return k[f]}}return false};c.prototype.removeListeners=function(f,h){for(var g=0;g<h.length;g++){h[g].element.removeEventListener(f,h[g].listener,false)}h.length=0};c.prototype.listenerSet=function(h,k){for(var f=0;f<h.length;f++){var j=false;if(!h[f].element.id){if(h[f].element.nodeName.toLowerCase()=="body"||h[f].element.nodeName.toLowerCase()=="#document"){j=h[f].element.nodeName.toLowerCase()}else{continue}}var g=false;if(!k.id){if(k.nodeName.toLowerCase()=="body"||k.nodeName.toLowerCase()=="#document"){g=k.nodeName.toLowerCase()}else{continue}}if(j&&g){if(j==g){return true}else{continue}}if(k.id==h[f].element.id){return true}}return false};c.prototype.registerListeners=function(k,p){this.registerDrop(p.element,p.settings.cbDrop,p.settings);this.registerDragEnd(p.element,p.settings.cbDragEnd,p.settings);for(var h=0;h<this.droppable.length;h++){if(!(this.droppable[h].settings.accept=="*"||(p.settings.scope.length>0&&p.settings.scope==this.droppable[h].settings.scope)||(this.droppable[h].settings.accept.length>0&&p.element.matches(this.droppable[h].settings.accept)))){continue}this.registerDragEnter(this.droppable[h].element,this.droppable[h].settings.cbDragEnter,this.droppable[h].settings);this.registerDragOver(this.droppable[h].element,this.droppable[h].settings.cbDragOver,this.droppable[h].settings);this.registerDragLeave(this.droppable[h].element,this.droppable[h].settings.cbDragLeave,this.droppable[h].settings);this.registerDrop(this.droppable[h].element,this.droppable[h].settings.cbDrop,this.droppable[h].settings);this.registerDragEnd(this.droppable[h].element,this.droppable[h].settings.cbDragEnd,this.droppable[h].settings)}this.registerDragEnter(document.body);this.registerDragOver(document.body);this.registerDragLeave(document.body);this.registerDrop(document.body);this.registerDragEnd(document);this.removeClone();this.removeContainment();if(p.settings.helper=="clone"){this.createClone(k,p)}if(p.settings.containment){this.containmentOffset={x:0,y:0,top:0,left:0};var i;var l=typeof p.settings.containment;var f=p.settings.containment;if(l=="string"&&f=="window"){i=[window.scrollX,window.scrollY,window.scrollX+window.innerWidth,window.scrollY+window.innerHeight]}else{if(l=="string"&&f=="document"){this.containment=document.body}else{if(l=="string"&&f.substr(0,1)=="#"){this.containment=$ms.$(f.substr,1)}else{if(l=="object"&&f instanceof HTMLElement){this.containment=f}else{if(l=="object"&&Array.isArray(f)){i={x1:f[0],y1:f[1],x2:f[2],y2:f[3]}}else{if(l=="object"&&typeof f.x1!=="undefined"){i=f}}}}}}if(p.settings.helper!=="clone"){p.settings.helper=="clone";this.createClone(k,p,this.containment)}if(i){this.addedContainment=true;this.containment=document.createElement("div");this.containment.style.height=f.y2-f.y1;this.containment.style.width=f.x2-f.x1;this.containment.style.top=f.y1;this.containment.style.left=f.x1;this.containment.style.position="absolute";this.containment.appendChild(this.clone);var n=this.calcClonePosition(k);this.clone.style.left=n.x+"px";this.clone.style.top=n.y+"px";document.body.appendChild(this.containment)}else{this.containment.appendChild(this.clone)}var o=getComputedStyle(this.containment).getPropertyValue("position");if(!(o=="absolute"||o=="relative")){var m=$ms.getOffset(this.containment);var g=$ms.getOffset(this.containment.offsetParent);this.containmentOffset={x:m.x-g.x,y:m.y-g.y}}}return p};c.prototype.createClone=function(i,g,f){this.clone=g.element.cloneNode(true);this.clone.style.display="none";this.clone.style.top=i.pageY-this.startOffset.y+"px";this.clone.style.left=i.pageX-this.startOffset.x+"px";this.clone.style.position="absolute";var h=$ms.getOffset(g.element);this.clone.style.width=h.width+"px";this.clone.style.height=h.height+"px";document.body.appendChild(this.clone);g.settings.element.style.visibility="hidden";this.clone.style.display="block"};c.prototype.removeClone=function(){if(this.clone){if(this.clone.parentNode){this.clone.parentNode.removeChild(this.clone)}this.clone=undefined}};c.prototype.calcClonePosition=function(i){var h=(i.pageX-this.startOffset.x);var g=(i.pageY-this.startOffset.y);if(this.containment){var f=$ms.getOffset(this.containment);h=Math.max(this.containmentOffset.x,Math.min(f.width-parseFloat(this.clone.style.width)+this.containmentOffset.x,h-f.left+this.containmentOffset.x));g=Math.max(this.containmentOffset.y,Math.min(f.height-parseFloat(this.clone.style.height)+this.containmentOffset.y,g-f.top+this.containmentOffset.y))}return{x:h,y:g}};c.prototype.removeContainment=function(){if(this.containment){if(this.addedContainment){this.addedContainment=false;if(this.containment.parentNode){this.containment.parentNode.removeChild(this.containment)}}this.containment=undefined}};c.prototype.revert=function(j,g,i){j.style.top=g.y;j.style.left=g.x;var l=i.x-g.x;var k=i.y-g.y;var h=500;var r=(l/h)*60;var q=(k/h)*60;var p=(l>0?1:-1);var m=(k>0?1:-1);var f=h/60;var o;(function n(u){if(!o){o=u}var w=u-o;if(w>f){var s=parseFloat(j.style.top);var t=parseFloat(j.style.left);if(m==1){var v=(s+=q)>i.y}else{var v=(s+=q)<i.y}if(p==1){var x=(t+=r)>i.x}else{var x=(t+=r)<i.x}if(v||x){j.style.top=i.y;j.style.left=i.x;return}else{j.style.top=s;j.style.left=t;requestAnimationFrame(function(){n(Date.now())})}o=u}requestAnimationFrame(function(){n(Date.now())})})(Date.now())};return c})();