
$msRoot.createNS("EditableCombo");$msRoot.EditableCombo=(function(n,d){var e=0;var k=[];var f={containerId:undefined,width:"200px",maxHeight:undefined,cbChange:undefined,observeSizeChanges:false,listenWindowClick:false};var g=$ms.STATIC_IMG_COMMON+"/design-combo-arrow.gif";var i=$ms.STATIC_IMG_COMMON+"/design-combo-arrow-over.gif";var m=$ms.STATIC_IMG_COMMON+"/design-combo-arrow-down.gif";var h=0;var j=false;var l=false;var b="rgb(0, 0, 197)";var a="rgb(255, 255, 255)";function c(o,p){this.id="ms-editableCombo-"+(e++)+"-";this.container;this.input;this.style={display:""};this.className="";this.value="";this.options=[];this.selectedOption;this.highlightedOption;this.settings=$ms.cloneSettings(f,p);this.optionCounter=0;this.optiondiv;this.arrow;this.iframe;this.inputHeight;this.observer;this.createEditableCombo(o);if(this.settings.listenWindowClick){this.closeOptionsFn=function(){this.closeOptions()}.bind(this);window.addEventListener("click",this.closeOptionsFn)}if(this.settings.observeSizeChanges){var q=function(r){if(r.animationName=="ms-onload"){this.setObserver()}}.bind(this);$ms.setOnLoad(this.container,q)}}c.prototype.setObserver=function(){var o=this;this.observer=new $ms.MutationObserver();this.observer.observe("#"+this.container.id,{observe:{attributes:true,attributeOldValue:true,attributeFilter:["style"]},querySelectorAll:false,cb:function(r,p){try{o.resize.call(o)}catch(q){}}.bind(this),property:["height","width"],})};c.prototype.switchImageUrl=function(){if(this.src.indexOf(g)>=0){this.src=this.src.replace(g,i)}else{this.src=this.src.replace(i,g)}};c.prototype.showOptions=function(E,A){E.stopPropagation();if(l&&l!=E.target){l.src=g}l=E.target;var p=this.optionDiv.style.display=="block";if(p&&!A){this.optionDiv.style.display="none"}else{this.optionDiv.style.removeProperty("height");this.optionDiv.style.top=this.inputHeight+"px";this.optionDiv.style.display="block";var s=$ms.getOffset(this.optionDiv).height;if(this.settings.maxHeight>0&&s>this.settings.maxHeight){s=this.settings.maxHeight;this.optionDiv.style.height=this.settings.maxHeight+"px"}var v=0;var B=0;var o=false;var C=this.container.parentNode;for(var D=0;D<5;D++){if(C&&C.scrollHeight&&C.clientHeight){if(getComputedStyle(C).getPropertyValue("overflow-y")=="hidden"){var x;v=C.scrollHeight-C.clientHeight;if(v>0){this.optionDiv.style.display="none";x=C.scrollHeight-C.clientHeight;if(x<v){B=$ms.getOffset(C).top;o=true}else{v=0}this.optionDiv.style.display="block"}break}C=C.parentNode}}var t=$ms.getOffset(this.input);var F=0;if($ms.hasHorizontalScroll()){F=$ms.getScrollBarSize()}var w=t.y-$ms.getScroll().y;var q=window.innerHeight-F-(w+this.inputHeight)-v;var y=w;if(o||s>q){if(s<y){this.optionDiv.style.top=-s+"px"}else{var u=s-q;var r=s-y;if(u<r){this.optionDiv.style.height=Math.max(100,s-u)+"px";this.optionDiv.style.top=this.inputHeight+"px"}else{if(v>0){this.optionDiv.style.height=Math.max(100,Math.min(t.top-B,s-r))+"px";this.optionDiv.style.top=-parseFloat(this.optionDiv.style.height)+"px"}else{this.optionDiv.style.height=Math.max(100,s-r)+"px";this.optionDiv.style.top=-parseFloat(this.optionDiv.style.height)+"px"}}}}if(j&&j!=this.optionDiv){j.style.display="none"}j=this.optionDiv}if(E.keyCode&&(E.keyCode==38||E.keyCode==40)){if(this.optionDiv.childNodes.length==0){return}if(!this.selectedOption){this.selectOption(this.options[0],{keepOpen:A,runCb:false});return}else{var z=-1;for(var D=0;D<this.optionDiv.childNodes.length;D++){if(this.optionDiv.childNodes[D].id==this.selectedOption.div.id){z=D;break}}if(p){switch(E.keyCode){case 38:z--;break;case 40:z++;break}}z=Math.min(z,this.optionDiv.childNodes.length-1);z=Math.max(z,0);this.selectOption(this.options[z],{keepOpen:A,runCb:false});return}}};c.prototype.selectOption=function(p,o){this.input.value=p.value;this.value=p.value;var q=p.div;if(!o){o={}}this.unhighlightAll();this.highlightedOption=undefined;if(this.selectedOption&&q.id!==this.selectedOption.div.id){this.selectedOption.div.style.backgroundColor="";this.selectedOption.div.style.color=""}this.selectedOption=p;$ms.addClass(this.selectedOption.div,"ms-editable-combo-selected");$ms.scrollIntoView(this.selectedOption.div);if(!o.keepOpen){this.closeOptions()}this.input.value=p.value;if(this.settings.cbChange&&o.runCb){this.settings.cbChange(this,true)}};c.prototype.setMouseoverOption=function(o){this.mouseoverOption(o,"on");$ms.scrollIntoView(o)};c.prototype.mouseoverOption=function(p,q){if(!this.highlightedOption){}else{$ms.removeClass(this.highlightedOption.div,"ms-editable-combo-mouseover");if(this.selectedOption&&this.selectedOption.div.id!==p.id&&this.selectedOption.div.id==this.highlightedOption.div.id){$ms.addClass(this.highlightedOption.div,"ms-editable-combo-selected")}}$ms.removeClass(p,"ms-editable-combo-selected");$ms.addClass(p,"ms-editable-combo-mouseover");for(var o=0;o<this.options.length;o++){if(this.options[o].div.id==p.id){this.highlightedOption=this.options[o];break}}};c.prototype.createEditableCombo=function(p){k.push(this);this.container=document.createElement("DIV");this.container.style.styleFloat="left";if(this.settings.containerId){this.container.id=this.settings.containerId}else{this.containerId=this.id+"-container"}this.container.className="ms-editable-combo-input-container";this.container.style.zIndex=10000+this.id;this.container.style.position="relative";this.input=document.createElement("input");if(this.settings.inputId){this.input.id=this.settings.inputId}else{this.input.id=this.id+"-input"}this.settings.width=parseInt(""+this.settings.width);this.input.style.width=(this.settings.width-18)+"px";this.input.className="ms-editable-combo-input";this.input.addEventListener("keyup",function(r){this.keyup(r)}.bind(this));this.container.style.width=this.settings.width+"px";this.container.appendChild(this.input);this.inputHeight=$ms.elementSize(this.input).height;var o=document.createElement("IMG");o.src=g;o.className="ms-editable-combo-arrow";o.onmouseover=this.switchImageUrl;o.onmouseout=this.switchImageUrl;o.onclick=function(r){this.showOptions(r),this.input.focus()}.bind(this);o.id=this.id+"arrow";this.container.appendChild(o);this.arrow=o;var q=document.createElement("DIV");this.optionDiv=q;q.id=this.id+"comboOptions";q.className="ms-editable-combo-option-container";q.style.width=this.settings.width+2+"px";q.addEventListener("keyup",function(r){this.keyup(r)}.bind(this));this.container.appendChild(q);this.input.addEventListener("dblclick",function(r){this.showOptions(r,true)});this.input.onclick=function(r){r.stopPropagation()};if(p&&p.length>0){this.createOptions(p);q.style.display="none";q.style.visibility="visible"}};c.prototype.createOptions=function(o,q){if(q){this.options.length=0;while(this.optionDiv.hasChildNodes()){this.optionDiv.removeChild(this.optionDiv.firstChild)}}for(var p=0;p<o.length;p++){this.createOption(o[p])}};c.prototype.createOption=function(o){var q=this;if(typeof o==="string"){o={label:o,value:o}}if(typeof o.label=="undefined"&&typeof o.name!=="undefined"){o.label=o.name}if(typeof o.value=="undefined"){o.value=o.label}else{if(typeof o.label=="undefined"){o.label=o.value}}var p=document.createElement("div");p.id=this.id+"option-"+(++this.optionCounter);p.innerHTML=o.label;p.className="ms-editable-combo-option";!function(s,r){s.addEventListener("click",function(t){q.selectOption(r,{keepOpen:false,runCb:true})}.bind(this),false)}(p,o);p.style.width=(this.settings.width-2)+"px";p.onmouseover=function(r){this.setMouseoverOption(r.target,"on")}.bind(this);o.div=p;this.options.push(o);this.optionDiv.appendChild(p);return p};c.prototype.closeOptions=function(){for(var o=0;o<k.length;o++){k[o].optionDiv.style.display="none";k[o].arrow.src=g}};c.prototype.findOption=function(q,r){var o;if(q.length==0){return false}for(var p=0;p<this.options;p++){if(r=="label"){o=this.options[p].label.toLowerCase()==q.toLowerCase()}else{if(r=="value"){o=this.options[p].value.toLowerCase()==q.toLowerCase()}}if(o){return this.options[p]}}return false};c.prototype.findClosestMatch=function(q,r){var o;if(q.length==0){return false}for(var p=0;p<this.options.length;p++){if(r=="label"){o=this.options[p].label.substr(0,q.length).toLowerCase()==q.toLowerCase()}else{if(r=="value"){o=this.options[p].value.substr(0,q.length).toLowerCase()==q.toLowerCase()}}if(o){return this.options[p]}}return false};c.prototype.addOption=function(o){this.createOption(o)};c.prototype.deleteOption=function(p){for(var o=0;o<this.options.length;o++){if(this.options[o].value==p){this.options[o].div.parentNode.removeChild(this.options[o].div);this.options.splice(o,1);this.clear();break}}};c.prototype.clear=function(){this.unhighlightAll();this.selectedOption=undefined;this.highlightedOption=undefined;this.updateValue()};c.prototype.unhighlightAll=function(){if(!this.optionDiv){return}for(var o=0;o<this.optionDiv.childNodes.length;o++){$ms.removeClass(this.optionDiv.childNodes[o],"ms-editable-combo-selected");$ms.removeClass(this.optionDiv.childNodes[o],"ms-editable-combo-mouseover")}};c.prototype.keyup=function(q){if(q.keyCode=="16"){}else{if(q.keyCode=="17"){}else{if(q.keyCode=="18"){}}}switch(q.keyCode){case 13:if(this.optionDiv.style.display=="block"){var p,o;if(this.selectedOption){o=this.selectedOption;p=this.selectedOption.div.innerHTML}else{if(this.highlightedOption){o=this.highlightedOption;p=this.highlightedOption.div.innerHTML}}if(typeof p!==undefined){this.selectOption(o,{keepOpen:false,runCb:true})}}else{var o=this.findClosestMatch(this.input.value,"label");if(o){this.showOptions(q,true);this.selectOption(o,{keepOpen:true,runCb:false})}}break;case 27:q.stopPropagation();this.closeOptions(this);break;case 33:break;case 34:break;case 35:break;case 36:break;case 37:break;case 39:break;case 38:case 40:this.showOptions(q,true);break;default:this.clear();var o=this.findClosestMatch(this.input.value,"label");if(o){this.showOptions(q,true);this.setMouseoverOption(o.div);if(this.settings.cbChange){this.settings.cbChange(this,false)}}else{this.closeOptions()}}};c.prototype.addEventListener=function(p,o){this.input.addEventListener(p,o)};c.prototype.getValue=function(){var o=this.findOption(this.input.value,"value");if(o===false){return this.input.value}return o.value};c.prototype.setAttribute=function(o,p){this[o]=p};c.prototype.getAttribute=function(o){return this[o]};c.prototype.setAttributes=function(){$ms.addClass(this.container,this.className);this.container.style.display=this.style.display;this.container.title=this.title;this.input.value=this.value;if(this.value.length>0){this.clear();var o=this.findOption(this.value,"value");if(o!==false){this.selectOption(o,{keepOpen:false,runCb:false})}}};c.prototype.setValue=function(o){this.clear();this.input.value=o;this.updateValue()};c.prototype.updateValue=function(){if(!this.selectedOption){this.value=this.input.value;for(var o=0;o<this.options.length;o++){if(this.value==this.options[o].value){this.selectOption(this.options[o],{keepOpen:false,runCb:false});break}}}else{var p;for(var o=0;o<this.optionDiv.childNodes.length;o++){if(this.optionDiv.childNodes[o].id==this.selectedOption.div.id){p=o;break}}if(typeof p!=="undefined"){this.value=this.options[o].value}}};c.prototype.resize=function(){this.settings.width=parseInt(this.container.style.width);this.optionDiv.style.width=this.settings.width+"px";this.input.style.width=(this.settings.width-18)+"px";for(var o=0;o<this.options.length;o++){this.options[o].div.style.width=(this.settings.width+2)+"px"}};c.prototype.close=function(){if(this.observer){this.observer.disconnect()}if(this.settings.listenWindowClick){window.removeEventListener("click",this.closeOptionsFn)}};return c})();