
$msRoot.createNS("LocalData");$msRoot.LocalData=(function(b){var a={key:"key",value:"value",records:"records",childKey:"name"};c.version="1.0";function c(d){this.settings=$ms.cloneSettings(a,d)}c.prototype.get=function(d,f){if(!d||!f){return false}var e=window.localStorage.getItem(d+"["+f+"]");return JSON.parse(e)};c.prototype.set=function(e,f,d){if(!e){return false}if(f==null||typeof f=="undefined"){f=this.nextId(e)}window.localStorage.setItem(e+"["+f+"]",JSON.stringify(d));return f};c.prototype.del=function(d,e){if(!d||!e){return false}window.localStorage.removeItem(d+"["+e+"]");return true};c.prototype.zap=function(m){if(!m){return false}var d=0;var k=null;var j=null;var h=m+".";var l=m+"[";var e=m.length+1;var g=[];for(var f=0;f<window.localStorage.length;f++){k=window.localStorage.key(f);j=k.substr(0,e);if(j==h||j==l){g.push(k);d++}}for(f=0;f<g.length;f++){window.localStorage.removeItem(g[f])}return d};c.prototype.zapAll=function(){window.localStorage.clear()};c.prototype.nextId=function(d){if(!d){return false}var e=0;e=window.localStorage.getItem(d+".nextId");if(!e){e=0}e++;window.localStorage.setItem(d+".nextId",e);return e};c.prototype.setProperty=function(d,f,e){if(!d||!f){return false}window.localStorage.setItem(d+"."+f,JSON.stringify(e))};c.prototype.getProperty=function(d,f){if(!d||!f){return false}var e=window.localStorage.getItem(d+"."+f);return JSON.parse(e)};c.prototype.getRecords=function(h){if(!h){return false}var g=null;var l,k;var j=[];var e=h+"[";for(var f=0;f<window.localStorage.length;f++){g=window.localStorage.key(f);if(e==g.substr(0,e.length)){l=g.substr(e.length);l=l.substr(0,l.length-1);k=window.localStorage.getItem(g);var d={};d[this.settings.key]=l;d[this.settings.value]=JSON.parse(k);j.push(d)}}return j};c.prototype.getProperties=function(n){if(!n){return false}var m=null;var d,l;var g=[];var k=n+".";var f=n.length+1;for(var h=0;h<window.localStorage.length;h++){m=window.localStorage.key(h);if(k==m.substr(0,f)){d=m.substr(f);l=window.localStorage.getItem(m);try{g.push({prop:d,value:JSON.parse(l)})}catch(j){console.log("Could not write property value: "+l)}}}return g};c.prototype.getTables=function(){var d=0;var g=null;var f=[];var j=[];var h;var k;for(var e=0;e<window.localStorage.length;e++){g=window.localStorage.key(e);k=g.indexOf("[");if(k!==-1){h=g.substr(0,k);f[h]=h}}for(var g in f){if(f.hasOwnProperty(g)){j.push(g)}}return j};c.prototype.getChild=function(j,l,k){if(!j||!l||!k){return false}var f=this.settings.key;var d=this.settings.records;var h=this.settings.childKey;var g=this.get(j,l);if(!g||!g[d]||!Array.isArray(g[d])){console.log("LocalData.getChild: Parent record doesn't exist or is in the wrong format: "+l);return false}for(var e=0;e<g[d].length;e++){if(g[d][e][h]==k){return g[d][e]}}};c.prototype.setChild=function(n,d,g,j){if(!n||d==null||typeof d=="undefined"){return false}if(g==null||typeof g=="undefined"){g=this.nextId(n)}var m=this.settings.key;var l=this.settings.value;var f=this.settings.records;var e=this.settings.childKey;var k=this.get(n,d);if(!k||!k[f]||!Array.isArray(k[f])){console.log("LocalData.setChild: Parent record doesn't exist or is in the wrong format: "+d);return false}for(var h=0;h<k[f].length;h++){if(k[f][h][e]==g){if(j[e]!==g){console.log("LocalData.setChild: Child record key ("+e+") doesn't exist in the child record being saved");return false}k[f][h]=j;this.set(n,d,k);return g}}k[f].push(j);this.set(n,d,k);return g};c.prototype.deleteChild=function(m,d,g){if(!m||!d||!g){return false}var l=this.settings.key;var j=this.settings.value;var f=this.settings.records;var e=this.settings.childKey;var k=this.get(m,d);if(!k||!k[f]||!Array.isArray(k[f])){console.log("LocalData.deleteChild: Parent record doesn't exist or is in the wrong format: "+d);return false}for(var h=0;h<k[f].length;h++){if(k[f][h][e]==g){k[f].splice(h,1);this.set(m,d,k);return true}}return false};return c})();