
$msRoot.createNS("Gradient");$msRoot.Gradient=(function(b){var h=[];var e=0;var f={startColor:"",newGradient:"rgb(255,255,255)",newLayer:"linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(0,0,0,1) 100%)",imgPath:$ms.STATIC_JS_COMMON+"/colorpicker/img",target:undefined,top:"100px",left:"100px",fontSize:75,zIndex:1000,container:undefined,cbUpdateColorPicker:undefined,cbClose:undefined,cbChange:undefined,cbCreate:undefined,pinColorPicker:false,colorPicker:undefined,minimal:false};var g=[{file:"localdata.min.js",ns:"LocalData"},{file:"localfile.min.js",ns:"LocalFile"},{file:"editable-combo.min.js",ns:"EditableCombo"},{file:"custom-dialog.min.js",ns:"CustomDialog"},{file:"dragdrop.min.js",ns:"DragDrop"},{file:"slider.min.js",ns:"Slider"},{file:"colorpicker.min.js",ns:"ColorPicker",subDir:"colorpicker"},{file:"colorlibrary.min.js",ns:"ColorPicker.ColorLibrary",subDir:"colorpicker"},];$ms.sourceFiles.add(g);$ms.sourceFiles.load();d.getInstance=function(k){if(typeof k!=="undefined"){for(var j=0;j<h.length;j++){if(h[j].id==k){return h[j]}}}else{return h}};function d(k){h.push(this);this.id="ms-gradient-"+e+++"-";this.aGradient=[];this.gradient;this.opacitySlider;this.currStop=-1;this.barMousedownSet=[];this.cs;this.deleteStopListener;this.cpLibrary;this.currLayer=-1;this.layerCounter=0;this.layerBusy=false;this.string;this.allLayersString;this.undoString;this.tab=0;this.lastDeletedStop={color:undefined,alpha:undefined};this.cssMode="rgb";this.init=false;this.degreesDialogOpen=false;this.ie9OrBelow=false;this.vendorFunctionPrefix=$ms.vendorFunctionPrefix("background","linear-gradient","(to top, black, white)","(top, black, white)");if(this.vendorFunctionPrefix===null){this.ie9OrBelow=$ms.ie9OrBelow()}this.settings=$ms.cloneSettings(f,k);if(!this.settings.container){this.settings.container=document.body}var k={saveLabel:"Save",cbSetColor:function(l){var m=l.name;if(this.tab==2){var o={id:this.id,dialogTitle:"Load Gradient",text:"Load a new gradient or add layer(s) to the current one?",buttons:[{label:"Gradient",title:"Replace the current gradient.",cb:function(){this.showGradientFromString(l.gradient)}.bind(this)},{label:"Layer(s)",title:"Add layer(s) to the existing gradient",cb:function(){this.showGradientFromString(l.gradient,true)}.bind(this)},{label:"Cancel",title:"Do not load the gradient"}],buttonClass:"",position:"fixed",textAlign:"left",buttonClass:"ms-gradient-button",buttonsOnTop:true,};var n=new $msRoot.CustomDialog(o)}else{this.setColor(l.gradient);this.cpLibrary.colorNameCombo.setValue(m)}}.bind(this),libSuffix:"gradient",valueToSet:"gradient",cbResize:function(l){this.colorLibResize(l)}.bind(this)};this.cpLibrary=new $msRoot.ColorPicker.ColorLibrary(k);this.container=this.createForm();$ms.draggable(this.container,{scope:"default",handle:this.id+"title-bar",cbDrop:this.drop.bind(this)});this.opacityInput=$ms.$(this.id+"opacity-stop-input");this.opacityLocationInput=$ms.$(this.id+"opacity-stop-location");this.colorInput=$ms.$(this.id+"color-stop-input");this.colorLocationInput=$ms.$(this.id+"color-stop-location");this.opacityDelete=$ms.$(this.id+"opacity-delete-area");this.colorDelete=$ms.$(this.id+"color-delete-area");this.opacityBar=$ms.$(this.id+"opacity-bar");this.colorBar=$ms.$(this.id+"color-bar");this.direction=$ms.$(this.id+"gradient-direction");this.tabsContainer=$ms.$(this.id+"tab-container");this.previewOuter=$ms.$(this.id+"preview-outer");this.previewWrapper=$ms.$(this.id+"preview-wrapper");this.previewWrapper2=$ms.$(this.id+"preview-wrapper2");this.preview=$ms.$(this.id+"preview");this.previewWidth=$ms.$(this.id+"export-width");this.previewHeight=$ms.$(this.id+"export-height");this.cssOuter=$ms.$(this.id+"css-outer");this.cssText=$ms.$(this.id+"css-text");this.layersOuter=$ms.$(this.id+"layers-outer");this.layersUl=$ms.$(this.id+"layer-ul");this.layersPreviewWrapper=$ms.$(this.id+"layers-preview-wrapper");this.importOuter=$ms.$(this.id+"import-outer");this.importText=$ms.$(this.id+"import-text");this.opacityInput.addEventListener("keydown",function(l){this.keydown(l,0,100,this.opacityInputKeyup)}.bind(this));this.opacityLocationInput.addEventListener("keydown",function(l){this.keydown(l,0,100,this.opacityLocationKeyup)}.bind(this));this.colorLocationInput.addEventListener("keydown",function(l){this.keydown(l,0,100,this.colorLocationKeyup)}.bind(this));this.opacityLocationInput.addEventListener("keyup",function(l){this.opacityLocationKeyup(l)}.bind(this));this.colorLocationInput.addEventListener("keyup",function(l){this.colorLocationKeyup(l)}.bind(this));this.opacityInput.addEventListener("keyup",function(l){this.opacityInputKeyup(l)}.bind(this));this.opacityLocationInput.addEventListener("blur",function(l){this.opacityLocationBlur(l)}.bind(this));this.colorLocationInput.addEventListener("blur",function(l){this.colorLocationBlur(l)}.bind(this));this.opacityInput.addEventListener("blur",function(l){this.opacityInputBlur(l)}.bind(this));this.previewWidth.addEventListener("keydown",function(l){this.keydown(l,0,5000,this.resizePreview)}.bind(this));this.previewHeight.addEventListener("keydown",function(l){this.keydown(l,0,5000,this.resizePreview)}.bind(this));this.previewWidth.addEventListener("keyup",function(l){this.resizePreview(l)}.bind(this));this.previewHeight.addEventListener("keyup",function(l){this.resizePreview(l)}.bind(this));this.cpLibrary.libraryNameCombo.setValue("Default");this.cpLibrary.libraryNameCombo.settings.cbChange({value:"Default"},true);this.showTab(0);this.showGradient(this.settings.startColor);if(this.settings.cbCreate){if(Array.isArray(this.settings.cbCreate)){for(var j=0;j<this.settings.cbCreate.length;j++){this.settings.cbCreate[j](this)}}else{this.settings.cbCreate(this)}}}d.prototype.onLoad=function(){var j=this;if(this.init){return}this.init=true;$ms.removeClass(this.container,"display-none");this.drop();this.resizePreview();this.observer=new $ms.MutationObserver();this.observer.observe("#"+this.tabsContainer.id,{observe:{attributes:true,attributeOldValue:true,attributeFilter:["style"]},querySelectorAll:false,cb:function(m,k){try{j.resizePreview.call(j)}catch(l){}}.bind(this),property:["height","width"],})};d.prototype.showGradient=function(j){if(j.indexOf("gradient")!==-1){this.showGradientFromString(j)}else{this.showGradientFromColor(j)}this.onLoad()};d.prototype.showGradientFromColor=function(j,n){if(j.indexOf("gradient")!==-1){this.showGradientFromString(j,n);return}this.resetSliders();this.gradient={};this.string=undefined;this.currStop=-1;var l,m=1;var k=$msRoot.colorMethods.colorInfo(j);if(k.rgbString==""){l=$msRoot.colorMethods.rgbToRgba([255,255,255],1)}else{l=k.rgbString}this.layerBusy=true;this.addStop({position:0,colorValue:l,type:"color",makeActive:true});this.addStop({position:100,colorValue:l,type:"color"});this.addStop({position:0,opacityValue:1,type:"opacity"});this.addStop({position:100,opacityValue:1,type:"opacity"});this.layerBusy=false;this.currStop=0;this.selectStopSlider(this.cs[0].slider);if(n){this.aGradient.splice(0,0,this.gradient)}else{this.resetLayers();this.aGradient=[this.gradient]}this.currLayer=0;this.createLayerLi(0);this.selectLayer(this.aGradient[0].li);this.updateVisuals();if(this.settings.startColor.length==0){this.settings.startColor=this.string.noPrefix}};d.prototype.resetLayers=function(){while(this.layersUl.hasChildNodes()){this.layersUl.removeChild(this.layersUl.firstChild)}};d.prototype.createLayerLi=function(o){var k=document.createElement("li");k.id=this.id+"li-"+this.layerCounter++;k.className="li-layer";this.aGradient[o].string=this.getGradientString(this.aGradient[o]);this.aGradient[o].li=k;var l=this.selectLayer.bind(this);var j=document.createElement("div");j.className="ms-cp-transparent-grid";k.appendChild(j);var n=document.createElement("div");!function(p){p.addEventListener("click",function(){l(p,true)})}(k);var m={scope:"layers",containment:this.layersUl};$ms.draggable(k,m);var m={scope:"layers",insert:"li.li-layer",classes:{active:"ms-highlight-border"},cbDrop:this.updateFromDragDrop.bind(this)};$ms.droppable(k,m);j.appendChild(n);this.setBackground(n,this.aGradient[o].string);if(this.layersUl.childNodes.length<o+1){this.layersUl.appendChild(k)}else{this.layersUl.insertBefore(k,this.layersUl.childNodes[o])}};d.prototype.showGradientFromString=function(k,n){if(typeof k!=="undefined"&&typeof this.settings.startColor=="undefined"){this.settings.startColor=k}if(k.indexOf("gradient")==-1){this.showGradientFromColor(k);return}var m=this.getParsedGradient(k);if(!m||m.length==0){this.showGradientFromColor("rgba(255, 255, 255, 1)");if(this.tab==3){alert("Couldn't parse the gradient CSS.")}return}if(n){for(var j=0;j<m.length;j++){this.aGradient.splice(j,0,m[j]);this.createLayerLi(j)}}else{this.resetLayers();this.aGradient=m;for(var j=0;j<m.length;j++){this.createLayerLi(j)}}this.resetSliders(n);this.selectLayer(this.aGradient[0].li);this.currLayer=0;this.gradient=this.aGradient[this.currLayer];this.string=this.gradient.string;this.direction.value=this.gradient.direction;if(typeof this.gradient.angle!=="undefined"){var l=this.angleToDirection(this.gradient.angle);if(l!==false){this.gradient.direction=l;this.direction.value=l}else{if(this.gradient.angle.indexOf("deg")!==-1){var o=parseInt(this.gradient.angle);this.direction.value=this.addDegreeComboOption(o)}}}this.cs=this.gradient.colorStop;this.colorStopsToSliders();for(var j=0;j<this.cs.length;j++){if(this.cs[j].type=="color"){this.currStop=j;this.selectStopSlider(this.cs[j].slider);break}}$ms.removeClass(this.container,"display-none");this.positionArrows();this.currLayer=0};d.prototype.addDegreeComboOption=function(m){m=parseInt(""+m);if(isNaN(m)){return""}var l="degrees: "+m;for(var j=0;j<this.direction.options.length;j++){if(this.direction.options[j].value.substr(0,9)=="degrees: "){this.direction.removeChild(this.direction.options[j])}}var k=document.createElement("option");k.value=l;k.innerHTML=l;this.direction.appendChild(k);return l};d.prototype.bringToFront=function(){var j=0;for(var k=0;k<h.length;k++){if(h.id!==this.id){j=Math.max(j,parseInt(h[k].container.style.zIndex))}}var l=$msRoot.ColorPicker.getInstance();for(var k=0;k<l.length;k++){j=Math.max(j,parseInt(l[k].container.style.zIndex))}this.container.style.zIndex=Math.max(parseInt(this.container.style.zIndex),j+1)};d.prototype.createForm=function(){var av,n,at,l,aj;var v=document.createElement("div");v.id=this.id+"container";v.className="ms-gradient draggable target display-none";v.style.top=this.settings.top;v.style.left=this.settings.left;v.style.zIndex=this.settings.zIndex;var ak=document.createElement("div");ak.id=this.id+"title-bar";ak.className="ms-title-bar draghandle";ak.draggable=true;ak.innerHTML="Gradient Generator";ak.addEventListener("mousedown",function(){this.bringToFront()}.bind(this));var at=$ms.createCloseButton(this.id,function(){this.cancel()}.bind(this));ak.appendChild(at);v.appendChild(ak);var J=document.createElement("div");J.className="ms-gradient-left-outer";v.appendChild(J);var ah=document.createElement("div");ah.className="ms-gradient-direction";J.appendChild(ah);var k=document.createElement("div");k.innerHTML="Direction";k.className="ms-gradient-label";ah.appendChild(k);var M=[{label:"bottom ↓",value:"to bottom"},{label:"right →",value:"to right"},{label:"top ↑",value:"to top"},{label:"left ←",value:"to left"},{label:"top right ↗",value:"45deg"},{label:"bottom right ↘",value:"135deg"},{label:"bottom left ↙",value:"225deg"},{label:"top left ↖",value:"315deg"},{label:"radial ○",value:"radial"},{label:"degrees",value:"degrees"}];var ar={onchange:function(){this.gradient.direction=this.direction.value;if(this.direction.value=="degrees"){if(!this.degreesDialogOpen){this.degreesDialog()}}else{this.gradient.degrees=this.validateDegrees(this.gradient.direction);this.updateVisuals()}}.bind(this),defaultValue:"to bottom"};var af=$ms.createCombo(M,ar);af.id=this.id+"gradient-direction";af.style.marginTop="5px";af.style.fontSize="90%";ah.appendChild(af);var t=document.createElement("div");t.className="ms-gradient-slider-outer";J.appendChild(t);var I=document.createElement("div");I.id=this.id+"opacity-stop-container";I.style.width="100%";I.style.position="relative";t.appendChild(I);var m=document.createElement("div");m.id=this.id+"opacity-delete-area";m.style.marginBottom="5px";m.style.height="10px";m.style.width="350px";I.appendChild(m);var ae=document.createElement("div");ae.id=this.id+"opacity-bar";ae.className="ms-gradient-slider-bar ms-gradient-opacity-bar";ae.style.height="20px";ae.style.width="350px";I.appendChild(ae);var O=document.createElement("div");O.style.height="20px";O.style.width="350px";O.className="ms-cp-transparent-grid";t.appendChild(O);var y=document.createElement("div");y.id=this.id+"gradient-bar";y.style.height="100%";y.style.width="100%";O.appendChild(y);var P=document.createElement("div");P.id=this.id+"color-stop-container";P.style.position="relative";P.style.width="350px";t.appendChild(P);var au=document.createElement("div");au.id=this.id+"color-bar";au.className="ms-gradient-slider-bar ms-gradient-color-bar";au.style.height="20px";au.style.width="350px";P.appendChild(au);var ac=document.createElement("div");ac.id=this.id+"color-delete-area";ac.style.marginTop="5px";ac.style.height="10px";ac.style.width="350px";P.appendChild(ac);var ag=document.createElement("div");ag.className="ms-gradient-reset";ag.title="Reset default color stop - will calculate based on position not last deleted stop.";ag.addEventListener("click",function(ax){this.lastDeletedStop={color:undefined,alpha:undefined}}.bind(this));t.appendChild(ag);var N=document.createElement("div");N.className="ms-gradient-reverse";N.title="Reverse order of color stops.";N.addEventListener("click",function(ay){for(var ax=0;ax<this.cs.length;ax++){this.cs[ax].position=100-this.cs[ax].position}this.selectLayer(this.aGradient[this.currLayer].li,true);this.updateVisuals()}.bind(this));t.appendChild(N);var o=document.createElement("div");o.className="ms-gradient-title-stops";o.innerHTML="Stops";J.appendChild(o);var F=document.createElement("table");F.className="ms-gradient-stop-table";var ab=[155,155];var p=document.createElement("colgroup");F.appendChild(p);for(var ap=0;ap<ab.length;ap++){var q=document.createElement("col");p.appendChild(q);q.style.width=ab[ap]+"px"}J.appendChild(F);var av=document.createElement("tr");F.appendChild(av);var n=document.createElement("td");n.style.verticalAlign="top";av.appendChild(n);var H=document.createElement("div");H.innerHTML="Opacity";H.className="ms-gradient-label";H.style.width="50px";n.appendChild(H);var ar={min:0,max:100,snapX:1,sliderWidth:65,inputWidth:30,inputId:this.id+"opacity-stop-input",textAfterInput:" %",button:false,sliderInput:true,parentNode:n,imgPath:this.settings.imgPath};this.opacitySlider=new $msRoot.Slider(undefined,ar);this.opacitySlider.onValuesChanged=function(){this.opacityInput.value=parseInt(this.opacitySlider.xValue);this.updateGradientFromInput();this.updateVisuals()}.bind(this);var n=document.createElement("td");n.style.verticalAlign="top";av.appendChild(n);var D=document.createElement("div");D.innerHTML="Location";D.className="ms-gradient-label";n.appendChild(D);var A=document.createElement("input");A.id=this.id+"opacity-stop-location";A.size=3;A.style.display="inline-block";A.style.width="35px";n.appendChild(A);var R=document.createElement("div");R.innerText="%";R.style.display="inline-block";R.style.marginLeft="2px";R.style.marginRight="5px";n.appendChild(R);var X=document.createElement("div");X.style.display="inline-block";X.style.width="45px";X.innerHTML="Delete";X.className="ms-gradient-button";X.addEventListener("click",function(ax){this.deleteOpacityStop(ax)}.bind(this));n.appendChild(X);var av=document.createElement("tr");F.appendChild(av);var n=document.createElement("td");n.style.verticalAlign="top";av.appendChild(n);var Z=document.createElement("div");Z.innerText="Color";Z.className="ms-gradient-label";Z.style.width="50px";n.appendChild(Z);var ao=document.createElement("div");ao.id=this.id+"color-stop-input";ao.className="ms-gradient-color-stop-input";ao.addEventListener("click",function(){if(this.colorInputSelected("color-input")){this.openColorPicker()}}.bind(this));n.appendChild(ao);var C=document.createElement("div");C.className="ms-gradient-button ms-button-tool ms-gradient-color-stop-button";C.innerHTML="►";C.addEventListener("click",function(){if(this.colorInputSelected("color-input")){this.openColorPicker()}}.bind(this));n.appendChild(C);var n=document.createElement("td");n.style.verticalAlign="top";av.appendChild(n);var D=document.createElement("div");D.innerText="Location";D.className="ms-gradient-label";n.appendChild(D);var A=document.createElement("input");A.id=this.id+"color-stop-location";A.size=3;A.style.display="inline-block";A.style.width="35px";n.appendChild(A);var R=document.createElement("div");R.innerText="%";R.style.display="inline-block";R.style.marginLeft="2px";R.style.marginRight="5px";n.appendChild(R);var Y=document.createElement("div");Y.style.display="inline-block";Y.style.width="45px";Y.innerHTML="Delete";Y.className="ms-gradient-button";Y.addEventListener("click",function(ax){this.deleteColorStop(ax)}.bind(this));n.appendChild(Y);var L=this.createTabs(["Preview","CSS","Layers","Import"]);L.id=this.id+"tab-container";$ms.addClass(L,"ms-gradient-tab-container");J.appendChild(L);var ai=document.createElement("div");ai.id=this.id+"preview-outer";ai.style.backgroundColor="rgb(240,240,240)";ai.className="ms-gradient-css display-none";L.appendChild(ai);var Q=document.createElement("div");Q.appendChild(document.createTextNode("Enter dimensions."));Q.className="ms-gradient-export-input";Q.style.padding="0 5px";ai.appendChild(Q);var F=document.createElement("table");F.width="100%";var av=document.createElement("tr");var n=document.createElement("td");n.appendChild(document.createTextNode("Width: "));av.appendChild(n);var n=document.createElement("td");var z=document.createElement("input");z.id=this.id+"export-width";z.value="200";z.size="8";n.appendChild(z);av.appendChild(n);F.appendChild(av);var av=document.createElement("tr");var n=document.createElement("td");n.appendChild(document.createTextNode("Height: "));av.appendChild(n);var n=document.createElement("td");var E=document.createElement("input");E.id=this.id+"export-height";E.size="8";E.value="200";n.appendChild(E);av.appendChild(n);F.appendChild(av);var av=document.createElement("tr");var n=document.createElement("td");n.colSpan=2;var W=document.createElement("div");W.innerHTML="Download PNG";W.className="ms-gradient-button";W.style.marginLeft="45px";W.style.display="inline-block";W.addEventListener("click",function(ax){this.downloadPNG(this.aGradient,{width:z.value,height:E.value})}.bind(this));n.appendChild(W);av.appendChild(n);F.appendChild(av);Q.appendChild(F);var S=document.createElement("div");S.id=this.id+"preview-wrapper";S.className="ms-gradient-preview-wrapper";ai.appendChild(S);var j=document.createElement("div");j.id=this.id+"preview-wrapper2";j.className="ms-cp-transparent-grid ms-gradient-preview-wrapper2";S.appendChild(j);var aa=document.createElement("div");aa.id=this.id+"preview";aa.className="ms-gradient-preview-inner";j.appendChild(aa);var G=document.createElement("div");G.id=this.id+"css-outer";G.className="ms-gradient-css display-none";L.appendChild(G);var r=document.createElement("div");r.id=this.id+"css-text";r.className="ms-gradient-css-text";G.appendChild(r);var B=document.createElement("div");B.innerHTML="Copy";B.className="ms-gradient-button ms-gradient-copy-button";B.style.width="40px";B.style.right="40px";B.addEventListener("click",function(ax){var ay=r.innerHTML.replace(/<\/div><div>/g,"\n").replace(/<[^>]+>/g,"");$ms.copyToClipboard(ay);$ms.removeClass($ms.$(this.id+"copy-status"),"display-none");setTimeout(function(){$ms.addClass($ms.$(this.id+"copy-status"),"display-none")}.bind(this),1000)}.bind(this));G.appendChild(B);var s=document.createElement("div");s.innerHTML="RGB";s.className="ms-gradient-button ms-gradient-copy-button";s.style.width="40px";s.style.right="85px";s.addEventListener("click",function(ax){this.cssMode="rgb";this.cssText.innerHTML=this.getCssText(this.cssMode)}.bind(this));G.appendChild(s);var an=document.createElement("div");an.innerHTML="HSL";an.className="ms-gradient-button ms-gradient-copy-button";an.style.width="40px";an.style.right="130px";an.addEventListener("click",function(ax){this.cssMode="hsl";this.cssText.innerHTML=this.getCssText(this.cssMode)}.bind(this));G.appendChild(an);var T=document.createElement("div");T.innerHTML="Hex";T.className="ms-gradient-button ms-gradient-copy-button";T.style.width="45px";T.style.right="175px";T.addEventListener("click",function(ax){this.cssMode="hex";this.cssText.innerHTML=this.getCssText(this.cssMode)}.bind(this));G.appendChild(T);var am=document.createElement("div");am.id=this.id+"copy-status";am.className="ms-gradient-copy-status display-none";am.innerHTML="Copied to Clipboard";G.appendChild(am);L.appendChild(G);var ai=document.createElement("div");ai.id=this.id+"layers-outer";ai.className="ms-gradient-layers-outer display-none";L.appendChild(ai);var U=document.createElement("div");U.id=this.id+"layers-listbox";U.className="ms-gradient-layers-listbox";ai.appendChild(U);var V=document.createElement("ul");V.id=this.id+"layer-ul";U.appendChild(V);var ar={scope:"layers",accept:"",append:"li.li-layer",noPosition:true,insert:"",classes:{active:""},cbDrop:this.updateFromDragDrop.bind(this)};$ms.droppable(V,ar);var al=document.createElement("div");al.className="ms-gradient-right-outer";v.appendChild(al);var K=document.createElement("div");K.className="ms-gradient-layer-button-div";ai.appendChild(K);var C=document.createElement("div");C.innerHTML="Add Layer";C.className="ms-gradient-button ms-gradient-layer-button";C.style.display="inline-block";C.addEventListener("click",function(ax){this.addLayer()}.bind(this));K.appendChild(C);var C=document.createElement("div");C.innerHTML="Delete Layer";C.className="ms-gradient-button ms-gradient-layer-button";C.style.display="inline-block";C.addEventListener("click",function(ax){this.deleteLayer()}.bind(this));K.appendChild(C);var ad=document.createElement("div");ad.id=this.id+"layers-preview-wrapper";ad.className="ms-cp-transparent-grid ms-gradient-preview-wrapper";ai.appendChild(ad);var aw=document.createElement("div");aw.id=this.id+"import-outer";aw.style.backgroundColor="rgb(240,240,240)";aw.className="ms-gradient-css display-none";L.appendChild(aw);var u=document.createElement("textarea");u.id=this.id+"import-text";u.placeholder="Enter a gradient string to import. Use Mozilla, Webkit, or W3C format: (e.g. linear-gradient(to top, rgb(0,0,0) 0%, rgba(255,0,0,0) 100%)";u.className="ms-gradient-css-text";u.style.resize="none";aw.appendChild(u);var aq=document.createElement("div");aq.innerHTML="Import";aq.className="ms-gradient-button ms-gradient-copy-button";aq.addEventListener("click",function(ax){this.showGradientFromString(u.value)}.bind(this));aw.appendChild(aq);var al=document.createElement("div");al.className="ms-gradient-right-outer";v.appendChild(al);var x=document.createElement("div");x.style.height="110px";al.appendChild(x);var C=document.createElement("div");C.innerHTML="Ok";C.className="ms-gradient-button ms-cp-button";C.style.display="block";C.style.width="120px";C.addEventListener("click",function(ax){this.save()}.bind(this));x.appendChild(C);var C=document.createElement("div");C.innerHTML="Cancel";C.className="ms-gradient-button ms-cp-button";C.style.display="block";C.style.width="120px";C.addEventListener("click",function(ax){this.cancel()}.bind(this));x.appendChild(C);var w=document.createElement("div");w.style.display="inline-block";w.style.width="120px";x.appendChild(w);var C=document.createElement("div");C.innerHTML="New";C.className="ms-gradient-button ms-cp-button";C.style.display="inline-block";C.style.width="53px";C.style.marginRight="11px";C.addEventListener("click",function(ax){this.cpLibrary.colorDeselect();this.showGradientFromColor(this.settings.newGradient)}.bind(this));w.appendChild(C);var C=document.createElement("div");C.innerHTML="Undo";C.className="ms-gradient-button ms-cp-button";C.style.display="inline-block";C.style.width="53px";C.addEventListener("click",function(ax){if(this.undoString){this.showGradientFromString(this.undoString)}}.bind(this));w.appendChild(C);var C=document.createElement("div");C.id=this.id+"remove-gradient";C.innerHTML="Remove Gradient";C.className="ms-gradient-button ms-cp-button";C.title="Click to remove the current gradient and revert to a single color";C.style.width="120px";C.addEventListener("click",function(ax){this.remove(ax)}.bind(this));x.appendChild(C);al.appendChild(this.cpLibrary.createForm());this.settings.container.appendChild(v);v.style.fontSize=$ms.targetFontSize(this.settings.fontSize,v);return v};d.prototype.deleteOpacityStop=function(){if(this.currStop==-1){return}this.deleteStop(this.cs[this.currStop].slider)};d.prototype.deleteColorStop=function(){if(this.currStop==-1){return}this.deleteStop(this.cs[this.currStop].slider)};d.prototype.colorStopsToSliders=function(){var m,v,n;var r,o;for(var w=this.cs.length-1;w>=0;w--){for(var t=w-1;t>=0;t--){if(this.cs[w].rgbString===this.cs[t].rgbString&&parseInt(this.cs[w].position)==parseInt(this.cs[t].position)){this.cs.splice(w,1);break}}}var j=0;var p=0;var E=[];this.currStop=0;for(var z=0;z<this.cs.length;z++){r=false;o=false;v=m;m=this.cs[z];if(z<this.cs.length-1){n=this.cs[z+1]}if(z==0||this.cs.length<3){r=true;o=true}else{if(z>0&&z<this.cs.length-1){var l=v.position;var x=n.position;var C=n.alpha-v.alpha;var y=n.rgb[0]-v.rgb[0];var F=n.rgb[1]-v.rgb[1];var k=n.rgb[2]-v.rgb[2];var B=this.cs[z].position;var u=m.alpha;var s=m.rgb[0];var A=m.rgb[1];var D=m.rgb[2];if(x-l==0){var q=0}else{var q=(B-l)/(x-l)}o=$ms.round(q*C+v.alpha,2)!==$ms.round(u,2);r=!($ms.round(q*y+v.rgb[0],0)==s&&$ms.round(q*F+v.rgb[1],0)==A&&$ms.round(q*k+v.rgb[2],0)==D);if(!o&&!r){r=true;o=true}}else{if(z==this.cs.length-1){r=true;o=true}}}if(r||(!r&&!o)){p++;this.cs[z].type="color"}if(o){j++;if(r&&o){E.push({rgbString:this.cs[z].rgbString,position:this.cs[z].position,rgb:this.cs[z].rgb,alpha:this.cs[z].alpha,hex:this.cs[z].hex,slider:undefined,type:"opacity"})}else{this.cs[z].type="opacity"}}}for(var z=0;z<E.length;z++){this.cs.push(E[z])}this.cs.sort(function(H,G){return H.position-G.position});this.layerBusy=true;for(var z=0;z<this.cs.length;z++){this.addStop({position:this.cs[z].position,index:z,type:this.cs[z].type})}this.layerBusy=false;this.updateVisuals()};d.prototype.addStop=function(o){var t=$ms.$(this.id+o.type+"-bar");var r,v;if(!this.gradient){this.gradient={}}if(!this.gradient.colorStop){this.gradient.colorStop=[]}this.cs=this.gradient.colorStop;if(!this.gradient.direction){this.gradient.direction="to bottom";this.gradient.sideCorner="bottom"}if(this.barMousedownSet.indexOf(t.id)==-1){this.barMousedownSet.push(t.id);r=function(y,x){var w=parseFloat(x.getValuesFromMousePosition(y).x);this.addStop({position:w,newFromPosition:true,type:o.type,makeActive:true});return false}.bind(this)}var v=function(x,w){x.stopPropagation();x.preventDefault();this.selectStopSlider(w);this.deleteStopListener=function(){this.deleteStop(w)}.bind(this);if(w.colorStop.type=="color"){$ms.addClass(this.colorDelete,"ms-gradient-delete-bar");this.colorDelete.addEventListener("mousemove",this.deleteStopListener)}else{$ms.addClass(this.opacityDelete,"ms-gradient-delete-bar");this.opacityDelete.addEventListener("mousemove",this.deleteStopListener)}$ms.removeClass(w.bar,"ms-gradient-slider-bar");return true}.bind(this);var m=function(x,w){x.stopPropagation();x.preventDefault();$ms.addClass(w.bar,"ms-gradient-slider-bar");if(w.colorStop.type=="color"){$ms.removeClass(this.colorDelete,"ms-gradient-delete-bar");if(this.deleteStopListener){this.colorDelete.removeEventListener("mousemove",this.deleteStopListener)}}else{$ms.removeClass(this.opacityDelete,"ms-gradient-delete-bar");if(this.deleteStopListener){this.opacityDelete.removeEventListener("mousemove",this.deleteStopListener)}}}.bind(this);var j=function(x,w){x.stopPropagation();x.preventDefault();if(w.colorStop.type=="color"){this.openColorPicker()}}.bind(this);var s={xMinValue:0,xMaxValue:100,yMinValue:1,yMaxValue:1,imgPath:this.settings.imgPath,arrowImage:undefined,sliderArrowClass:"ms-slider-arrow-"+(o.type=="color"?"bottom":"top")+"-unselected",container:$ms.$(this.id+o.type+"-bar"),direction:"horizontal",snapX:1,cbSliderBarMousedown:r,cbSliderArrowMousedown:v,cbSliderMouseup:m,cbSliderArrowDblclick:j,ignoreBarMousedown:(typeof r=="undefined")};var l=new $msRoot.Slider(t,s);var n=document.createElement("div");n.id=this.id+"arrow-color";n.className="ms-slider-arrow-inner ms-slider-arrow-inner-"+o.type;l.arrow.appendChild(n);l.arrow.title=o.type.charAt(0).toUpperCase()+o.type.slice(1)+" Stop";l.arrowInner=n;var q;var k=o.type=="color"?"opacity":"color";if(typeof o.colorValue!=="undefined"){q=$msRoot.colorMethods.colorInfo(o.colorValue);this.cs.push({rgbString:o.colorValue,position:o.position,rgb:q.rgb,alpha:q.alpha,hex:q.hex,slider:l,type:o.type});o.index=this.cs.length-1}else{if(typeof o.opacityValue!=="undefined"){q=this.valueFromPosition(o.position,k);this.cs.push({rgbString:q.rgbString,position:o.position,rgb:q.rgb,alpha:o.opacityValue,hex:q.hex,slider:l,type:o.type});o.index=this.cs.length-1}else{if(typeof o.index!=="undefined"){this.cs[o.index].slider=l}else{if(typeof o.newFromPosition){q=this.valueFromPosition(o.position,"any");if(o.type=="color"&&typeof this.lastDeletedStop.color!=="undefined"){var p=q.alpha;q=$msRoot.colorMethods.colorInfo(this.lastDeletedStop.color.rgbString);q.alpha=p}else{if(o.type=="opacity"&&typeof this.lastDeletedStop.opacity!=="undefined"){q.alpha=this.lastDeletedStop.opacity.alpha}}this.cs.push({rgbString:q.rgbString,position:o.position,rgb:q.rgb,alpha:q.alpha,hex:q.hex,slider:l,type:o.type});o.index=this.cs.length-1}}}}l.xValue=o.position;l.setArrowPositionFromValues();l.colorStop=this.cs[o.index];if(o.type=="color"){l.arrowInner.style.backgroundColor="rgb("+l.colorStop.rgb[0]+","+l.colorStop.rgb[1]+","+l.colorStop.rgb[2]+")"}else{var u=l.colorStop.alpha*255;l.arrowInner.style.backgroundColor="rgb("+u+","+u+","+u+")"}if(o.makeActive){this.currStop=o.index;this.selectStopSlider(l)}this.updateVisuals();l.onValuesChanged=function(w){this.gradientValuesChanged(w);this.updateVisuals()}.bind(this)};d.prototype.deleteStop=function(m){var k=this.getFilteredStopType(m.colorStop.type);var l;if(m.colorStop.type=="color"){l=this.colorDelete}else{l=this.opacityDelete}if(k.length<3){$ms.removeClass(l,"ms-gradient-delete-bar");$ms.addClass(l,"ms-gradient-delete-bar-not-allowed");setTimeout(function(){$ms.removeClass(l,"ms-gradient-delete-bar-not-allowed")}.bind(this),1000);return}setTimeout(function(){$ms.removeClass(l,"ms-gradient-delete-bar")}.bind(this),1000);l.removeEventListener("mousemove",this.deleteStopListener);this.lastDeletedStop[m.colorStop.type]={rgbString:m.colorStop.rgbString,alpha:m.colorStop.alpha};for(var j=0;j<this.cs.length;j++){if(this.cs[j].slider.id==m.id){this.cs.splice(j,1);break}}$ms.addClass(m.bar,"ms-gradient-slider-bar");m.close();this.selectStopSlider();if(m.colorStop.type=="opacity"){this.recalcOpacityForColorStops()}else{if(m.colorStop.type=="color"){this.recalcColorForOpacityStops()}}this.updateVisuals()};d.prototype.gradientValuesChanged=function(l){var k;if(!l&&this.currStop==-1){return}if(!l){l=this.cs[this.currStop].slider}var j=parseInt(l.xValue);l.colorStop.position=j;if(l.colorStop.type=="opacity"){var k=this.valueFromPosition(j,"color");l.colorStop.hex=k.hex;l.colorStop.rgb=k.rgb;l.colorStop.rgbString=$msRoot.colorMethods.rgbToRgba(k.rgb,l.colorStop.alpha);this.opacitySlider.xValue=this.opacityInput.value;this.opacitySlider.setArrowPositionFromValues();this.recalcOpacityForColorStops()}else{if(l.colorStop.type=="color"){var k=this.valueFromPosition(j,"opacity");l.colorStop.alpha=k.alpha;l.colorStop.rgbString=$msRoot.colorMethods.rgbToRgba(l.colorStop.rgb,k.alpha);this.recalcColorForOpacityStops()}}};d.prototype.recalcOpacityForColorStops=function(){var k=this.getFilteredStopType("color");for(var l=0;l<k.length;l++){var j=this.valueFromPosition(k[l].position,"opacity");k[l].alpha=j.alpha;k[l].rgbString=$msRoot.colorMethods.rgbToRgba(k[l].rgb,j.alpha)}};d.prototype.recalcColorForOpacityStops=function(){var k=this.getFilteredStopType("opacity");for(var l=0;l<k.length;l++){var j=this.valueFromPosition(k[l].position,"color");k[l].hex=j.hex;k[l].rgb=j.rgb;k[l].rgbString=$msRoot.colorMethods.rgbToRgba(j.rgb,k[l].alpha)}};d.prototype.getFilteredStopType=function(k){var m=this.cs.slice();m.sort(function(o,n){return o.position-n.position});if(k=="any"){return m}var l=[];for(var j=0;j<m.length;j++){if(m[j].type!==k){continue}l.push(m[j])}return l};d.prototype.valueFromPosition=function(r,k){if(typeof k=="undefined"){k="any"}var v=this.getFilteredStopType(k);var m=0,t=0,p={alpha:1,rgb:[0,0,0]},n={alpha:1,rgb:[0,0,0]};for(var q=0;q<v.length;q++){if(+v[q].position==+r){return v[q]}else{if(+v[q].position>+r){if(q==0){return v[q]}else{t=v[q].position;p=v[q];break}}else{m=v[q].position;n=v[q]}}}var l=(parseFloat(n.alpha)-parseFloat(p.alpha));var j=n.rgb[0]-p.rgb[0];var s=n.rgb[1]-p.rgb[1];var w=n.rgb[2]-p.rgb[2];var x=0;if(t-m>0){x=(r-m)/(t-m)}var o=$ms.round(n.alpha-x*l,2);var u=[$ms.round(n.rgb[0]-x*j,0),$ms.round(n.rgb[1]-x*s,0),$ms.round(n.rgb[2]-x*w,0)];return $msRoot.colorMethods.colorInfo(u,o)};d.prototype.updateInputValuesFromStop=function(){if(this.currStop==-1){return}if(this.cs[this.currStop].type=="opacity"){this.opacityInput.value=parseInt(this.cs[this.currStop].alpha*100);this.opacityLocationInput.value=parseInt(this.cs[this.currStop].position);this.colorInput.innerHTML="";this.colorInput.style.backgroundColor="";this.colorLocationInput.value=""}else{var j=this.cs[this.currStop].rgb.slice();j.length=Math.min(3,this.cs[this.currStop].rgb.length);this.colorInput.style.backgroundColor="rgb("+j.join()+")";this.colorInput.InnerHTML="rgb("+j.join()+")";this.colorInput.style.color=$msRoot.colorMethods.highlightcolor(this.cs[this.currStop].rgb[0],this.cs[this.currStop].rgb[1],this.cs[this.currStop].rgb[2]);this.colorLocationInput.value=parseInt(this.cs[this.currStop].position);this.opacityInput.value="";this.opacityLocationInput.value=""}};d.prototype.updateStopFromInputValues=function(){if(this.currStop==-1){return}if(this.cs[this.currStop].type=="opacity"){this.cs[this.currStop].alpha=this.opacityInput.value;this.gradientValuesChanged();this.updateVisuals()}};d.prototype.updateStopFromColor=function(j){if(this.currStop>-1){this.cs[this.currStop].rgbString=j.rgbString;this.cs[this.currStop].hex=j.hex;this.cs[this.currStop].rgb=j.rgb;for(var k=0;k<this.cs.length;k++){if(this.cs[k].position==this.cs[this.currStop].position){this.cs[k].rgbString=j.rgbString;this.cs[k].hex=j.hex;this.cs[k].rgb=j.rgb}}}};d.prototype.colorStopType=function(j){if(j==-1){return""}return this.cs[j].type};d.prototype.updateVisuals=function(){this.updateArrows();if(this.layerBusy||this.currLayer==-1){return}this.string=this.getGradientString(this.gradient);this.aGradient[this.currLayer].string=this.string;var j=this.getGradientString(this.gradient,"to right");if(!j){return}if(this.allLayersString){this.undoString=this.allLayersString.noPrefix}this.allLayersString=this.getGradientString(this.aGradient);this.setBackground($ms.$(this.id+"gradient-bar"),j);this.setBackground(this.preview,this.allLayersString);this.setBackground(this.aGradient[this.currLayer].li.firstChild.firstChild,j);this.cpLibrary.color={gradient:this.allLayersString.noPrefix};if(this.tab==1){this.cssText.innerHTML=this.getCssText(this.cssMode)}this.updateTarget();if(this.settings.colorPicker&&!$ms.hasClass(this.settings.colorPicker.container,"display-none")){this.settings.colorPicker.updateVisuals(true)}};d.prototype.getCssText=function(p){var n="",l="",k="",o="";for(var m=0;m<this.aGradient.length;m++){if(m>0){n+=",";l+=",";k+=","}if(p=="rgb"){n+=this.aGradient[m].string.moz;l+=this.aGradient[m].string.webkit;k+=this.aGradient[m].string.noPrefix;if(m==0){o=this.aGradient[m].string.ie}}else{var j=this.getGradientString(this.aGradient[m],undefined,p);n+=j.moz;l+=j.webkit;k+=j.noPrefix;if(m==0){o=j.ie}}}return"<div>background: "+n+";</div><div>background: "+l+";</div><div>background: "+k+";</div><div>background: "+o+";</div>"};d.prototype.updateArrows=function(){if(this.currStop>-1){var j=this.cs[this.currStop].slider;if(j.colorStop.type=="color"){j.arrowInner.style.backgroundColor="rgb("+j.colorStop.rgb[0]+","+j.colorStop.rgb[1]+","+j.colorStop.rgb[2]+")"}else{var k=j.colorStop.alpha*255;j.arrowInner.style.backgroundColor="rgb("+k+","+k+","+k+")"}this.updateInputValuesFromStop()}};d.prototype.setBackground=function(j,k){j.style.background=k.vendor;if(this.ie9OrBelow){j.style.filter=k.vendor.replace("filter: ","")}};d.prototype.getGradientString=function(n,E,s){var o,k;var t=false;var v="",F="",q="",C="",u,m,l;if(!n){return false}if(Array.isArray(n)){o=n}else{o=[n]}for(var z=0;z<o.length;z++){k=o[z];if(v.length>0){v+=",";F+=",";q+=",";C+=","}if(typeof E=="undefined"||z>0){E=k.direction}var y="top";switch(E){case"to bottom":y="top";break;case"to right":y="left";break;case"to top":y="bottom";break;case"to left":y="right";break;case"135deg":case"to top left":y="135deg";break;case"45deg":case"to top right":y="45deg";break;case"315deg":case"to bottom right":y="315deg";break;case"225deg":case"to bottom left":y="225deg";break;case"radial":y="radial";break;default:if(E.indexOf("degrees")!==-1){E=k.degrees+"deg";y=E}else{if(E.indexOf("deg")!==-1){y=E}}break}var D=k.colorStop.slice();for(var x=D.length-1;x>=0;x--){for(var w=x-1;w>=0;w--){if(D[x].rgbString===D[w].rgbString&&parseInt(D[x].position)==parseInt(D[w].position)){D.splice(x,1);break}}}D.sort(function(G,j){return G.position-j.position});var p="";for(var A=0;A<D.length;A++){if(!s||s=="rgb"){p+=", "+D[A].rgbString+" "+parseInt(D[A].position)+"%"}else{if(s=="hsl"){var r=$msRoot.colorMethods.rgbToHsl(D[A].rgb);p+=", "+r.hslString+" "+parseInt(D[A].position)+"%"}else{if(s=="hex"){p+=", "+D[A].hex+" "+parseInt(D[A].position)+"%"}}}}if(E=="radial"){v+="radial-gradient(ellipse at center"+p+")";F+="-moz-radial-gradient(center, ellipse cover"+p+")";q+="-webkit-radial-gradient(center, ellipse cover"+p+")";u=E=="to right"?"1":"0";m=D[0].hex;l=D[D.length-1].hex;if(z==0){C="filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='"+m+"', endColorstr='"+l+"',GradientType="+u+")"}}else{v+="linear-gradient("+E+p+")";F+="-moz-linear-gradient("+y+p+")";q+="-webkit-linear-gradient("+y+p+")";u=E=="to right"?"1":"0";m=D[0].hex;l=D[D.length-1].hex;if(z==0){C+="filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='"+m+"', endColorstr='"+l+"',GradientType="+u+")"}}var B="";switch(this.vendorFunctionPrefix){case"":B=v;break;case"-webkit-":B=q;break;case"-moz-":B=F;break;case null:if(this.ie9OrBelow){B=C}break}}return{noPrefix:v,moz:F,webkit:q,ie:C,vendor:B}};d.prototype.selectStopSlider=function(k){for(var j=0;j<this.cs.length;j++){$ms.removeClass(this.cs[j].slider.arrow,"ms-slider-arrow-"+(this.cs[j].slider.colorStop.type=="color"?"bottom":"top")+"-selected");$ms.addClass(this.cs[j].slider.arrow,"ms-slider-arrow-"+(this.cs[j].slider.colorStop.type=="color"?"bottom":"top")+"-unselected")}if(!k){this.currStop=-1;this.disableAll();return}for(var j=0;j<this.cs.length;j++){if(this.cs[j].slider.id==k.id){this.currStop=j;break}}$ms.addClass(k.arrow,"ms-slider-arrow-"+(k.colorStop.type=="color"?"bottom":"top")+"-selected");if(k.colorStop.type=="color"){this.colorInputSelected()}else{if(k.colorStop.type=="opacity"){this.opacityInputSelected()}else{this.disableAll()}}};d.prototype.getParsedGradient=function(k){var u;var n=[];var r=[];if(!k||k.length==0||k.indexOf("gradient(")==-1){return[]}var v=/(?:\s*)(?:linear|radial)-gradient\s*\(((?:\([^\)]*\)|[^\)\(])*)\)/g;var q;while(q=v.exec(k)){n.push(q[0])}if(n.length==0){return[]}for(var o=0;o<n.length;o++){u=n[o];if(u.length==0){break}if(u.indexOf("to ")==-1){u=u.replace("linear-gradient(","linear-gradient(to bottom, ")}var l=c();var s=/.*gradient\s*\(((?:\([^\)]*\)|[^\)\(]*)*)\)/;var q=s.exec(u);if(q!==null){var t=i(l,q[1]);if(t){if(!t.direction&&u.indexOf("radial")!==-1){t.direction="radial";t.radialDirection="ellipse at center";t.string="ellipse at center"+t.string}for(var p=0;p<t.colorStop.length;p++){var m=$msRoot.colorMethods.colorInfo(t.colorStop[p].color);delete t.colorStop[p].color;if(typeof t.colorStop[p].position!=="undefined"){t.colorStop[p].position=t.colorStop[p].position.replace("%","")}else{if(t.colorStop.length==1){t.colorStop[p].position="100"}else{t.colorStop[p].position=""+((p/(t.colorStop.length-1))*100)}}t.colorStop[p].hex=m.hex;t.colorStop[p].rgb=m.rgb;t.colorStop[p].rgba=m.rga;t.colorStop[p].alpha=m.alpha;t.colorStop[p].rgbString=m.rgbString}r.push(t)}}}return r};var c=function(){var s="gi",j=/(?:[+-]?\d*\.?\d+)(?:deg|grad|rad|turn)/,l=/(?:to\s+)?((?:(?:left|right|top|bottom|ellipse at center|center, ellipse cover|)(?:\s+(?:top|bottom))?))/,x=/\s*,\s*/,t=/\#(?:[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/,r=/\(\s*(?:[0-9]{1,3}\s*,\s*){1}\s*(?:[0-9]{1,3}(?:%)?\s*,\s*){1}[0-9]{1,3}(?:%)?\s*\)/,q=/\(\s*(?:[0-9]{1,3}\s*,\s*){1}\s*(?:[0-9]{1,3}(?:%)?\s*,\s*){2}\s*(?:[0-9]{1,3}(?:%)?(?:[.][0-9]{1,3})?\s*)\)/,u=/(?:[+-]?\d*\.?\d+)(?:%|[a-z]+)?/,v=/[_A-Za-z-][_A-Za-z0-9-]*/,k=a(["(?:",t,"|","(?:rgb|hsl)",r,"|","(?:rgba|hsla)",q,"|",v,")"],""),w=a([k,"(?:\\s+",u,")?"],""),o=a(["(?:",w,x,")*",w],""),n=a(["(?:(",j,")|",l,")"],""),m=a(["(",n,")",x,"(",o,")"],s),p=a(["\\s*(",k,")","(?:\\s+","(",u,"))?","(?:",x,"\\s*)?"],s);return{gradientSearch:m,colorStopSearch:p}};var a=function(l,j){var k,m="";for(k=0;k<l.length;k++){if(typeof l[k]==="string"){m+=l[k]}else{m+=l[k].source}}return new RegExp(m,j)};var i=function(k,m){var j,n,o,l;n=k.gradientSearch.exec(m);if(n!==null){j={string:n[0],colorStop:[]};if(!!n[1]){j.direction=n[1];if(j.direction.indexOf("ellipse")!==-1||j.direction.indexOf("circle")!==-1){j.direction="radial";j.radialDirection=n[1]}}if(!!n[2]){j.angle=n[2]}if(!!n[3]){j.sideCorner=n[3]}o=k.colorStopSearch.exec(n[4]);while(o!==null){l={color:o[1]};if(!!o[2]){l.position=o[2]}j.colorStop.push(l);o=k.colorStopSearch.exec(n[4])}}return j};d.prototype.updateGradientFromInput=function(){var j=false;if(this.colorStopType(this.currStop)=="color"){var k=$msRoot.colorMethods.rgbToHex(this.colorInput.innerHTML);this.updateCurrentStopFromHex(k)}else{if(this.colorStopType(this.currStop)=="opacity"){this.cs[this.currStop].alpha=this.opacityInput.value/100}}this.gradientValuesChanged();this.updateVisuals()};d.prototype.updateCurrentStopFromHex=function(l){if(this.currStop>-1){var j=$msRoot.colorMethods.colorInfo(l,this.cs[this.currStop].alpha);this.cs[this.currStop].rgbString=j.rgbString;this.cs[this.currStop].hex=j.hex;this.cs[this.currStop].rgb=j.rgb;for(var k=0;k<this.cs.length;k++){if(this.cs[k].position==this.cs[this.currStop].position){this.cs[k].rgbString=j.rgbString;this.cs[k].hex=j.hex;this.cs[k].rgb=j.rgb}}}};d.prototype.setColor=function(j){this.showGradientFromString(j);if(this.settings.colorPicker&&!$ms.hasClass(this.settings.colorPicker.container,"display-none")){this.settings.colorPicker.hide()}};d.prototype.colorInputSelected=function(j){if(j&&j=="color-input"&&$ms.hasClass(this.colorInput,"ms-disabled")){return false}$ms.removeClass(this.colorInput,"ms-disabled");$ms.removeClass(this.colorLocationInput,"ms-disabled");this.colorLocationInput.removeAttribute("disabled");$ms.addClass(this.opacityInput,"ms-disabled");$ms.addClass(this.opacityLocationInput,"ms-disabled");this.opacityInput.disabled="disabled";this.opacityLocationInput.disabled="disabled";this.opacitySlider.disable();this.updateInputValuesFromStop();if(this.settings.colorPicker){this.updatingColorPicker=true;this.settings.cbUpdateColorPicker(this.cs[this.currStop]);this.updatingColorPicker=false}return true};d.prototype.opacityInputSelected=function(j){if(j&&j=="opacity-input"&&$ms.hasClass(this.opacityInput,"ms-disabled")){return}$ms.removeClass(this.opacityInput,"ms-disabled");$ms.removeClass(this.opacityLocationInput,"ms-disabled");this.opacityLocationInput.removeAttribute("disabled");this.opacityInput.removeAttribute("disabled");this.opacitySlider.enable();this.opacityInput.value=parseInt(this.cs[this.currStop].alpha*100);this.opacitySlider.xValue=parseInt(this.cs[this.currStop].alpha*100);this.opacitySlider.setArrowPositionFromValues();$ms.addClass(this.colorInput,"ms-disabled");$ms.addClass(this.colorLocationInput,"ms-disabled");this.colorLocationInput.disabled="disabled";this.updateInputValuesFromStop();if(this.settings.colorPicker){this.settings.colorPicker.close();this.settings.colorPicker=undefined}};d.prototype.disableAll=function(){$ms.addClass(this.colorInput,"ms-disabled");$ms.addClass(this.colorLocationInput,"ms-disabled");this.colorLocationInput.disabled="disabled";$ms.addClass(this.opacityInput,"ms-disabled");$ms.addClass(this.opacityLocationInput,"ms-disabled");this.opacityLocationInput.disabled="disabled";this.opacitySlider.disable();if(this.cbDisable){this.cbDisable()}};d.prototype.opacityInputKeyup=function(j){if(this.currStop==-1){return}if(this.cs[this.currStop].type=="color"){return}if(j.target.value==""){return}this.opacityValueChanged(j.target);this.opacityInputSelected("opacity-input")};d.prototype.opacityInputBlur=function(j){if(this.currStop==-1){return}if(this.cs[this.currStop].type=="color"){return}if(j.target.value==""){this.opacityValueChanged(j.target)}};d.prototype.opacityLocationKeyup=function(j){if(this.currStop==-1){return}if(this.cs[this.currStop].type=="color"){return}this.locationChanged(j.target);this.opacityInputSelected("opacity-input");if(j.target.value==""){return}};d.prototype.opacityLocationBlur=function(j){if(this.currStop==-1){return}if(this.cs[this.currStop].type=="color"){return}if(j.target.value==""){this.locationChanged(j.target)}};d.prototype.colorLocationKeyup=function(j){if(this.currStop==-1){return}if(this.cs[this.currStop].type=="opacity"){return}if(this.currStop==-1){return}this.locationChanged(j.target);this.colorInputSelected("color-input");if(j.target.value==""){return}};d.prototype.colorLocationBlur=function(j){if(this.currStop==-1){return}if(this.cs[this.currStop].type=="opacity"){return}if(j.target.value==""){this.locationChanged(j.target)}};d.prototype.keydown=function(m,l,k,j){if(this.currStop==-1){return}if(m.target.id.indexOf("color")!==-1&&this.cs[this.currStop].type=="opacity"){return}if(m.target.id.indexOf("opacity")!==-1&&this.cs[this.currStop].type=="color"){return}if(m.keyCode==38){if(typeof l=="undefined"){return}if(m.target.value==""){m.target.value=l}m.target.value=Math.min(parseInt(m.target.value)+1,k);if(j){j.call(this,m)}m.stopPropagation()}else{if(m.keyCode==40){if(typeof l=="undefined"){return}if(m.target.value==""){m.target.value=l}m.target.value=Math.max(parseInt(m.target.value)-1,l);if(j){j.call(this,m)}m.stopPropagation()}else{if(j){j.call(this,m)}}}};d.prototype.opacityValueChanged=function(){var j=parseInt(this.opacityInput.value);if(j==0&&""+j!==this.opacityInput.value){j=100}if(j<0||j>100){j=100}this.opacityInput.value=j;this.opacitySlider.xValue=this.opacityInput.value;this.opacitySlider.setArrowPositionFromValues();this.cs[this.currStop].alpha=j/100;this.gradientValuesChanged();this.updateVisuals()};d.prototype.locationChanged=function(k){var j=parseInt(k.value);if(j==0&&""+j!==k.value){return}if(j<0||j>100){return}if(isNaN(j)){return}this.cs[this.currStop].position=j;this.cs[this.currStop].slider.xValue=j;this.cs[this.currStop].slider.setArrowPositionFromValues();this.gradientValuesChanged(this.cs[this.currStop].slider);this.updateVisuals()};d.prototype.positionArrows=function(){for(var j=0;j<this.cs.length;j++){this.cs[j].slider.setPositioningVariables()}this.opacitySlider.setArrowPositionFromValues()};d.prototype.drop=function(j){for(var k=0;k<this.cs.length;k++){this.cs[k].slider.setPositioningVariables()}if(typeof j=="boolean"&&j){return}if(this.settings.colorPicker&&!$ms.hasClass(this.settings.colorPicker,"display-none"&&this.settings.colorPicker.isPinned)){this.settings.colorPicker.drop(true)}};d.prototype.createTabs=function(k){var o=this;var n=document.createElement("div");n.id=this.id+"tab-container";n.className="ms-tabs ms-gradient-tabs";n.style.position="relative";n.backgroundColor="rgb(230,230,230)";var m=document.createElement("ul");m.id=this.id+"tab-ul";m.className="tab-primary";n.appendChild(m);for(var l=0;l<k.length;l++){var j=document.createElement("li");j.id=this.id+"tab-"+l;j.innerHTML=k[l];!function(p){j.addEventListener("click",function(q){o.showTab(p)},false)}(l);if(l==0){j.className="tab-current"}m.appendChild(j)}return n};d.prototype.showTab=function(l){var k;for(var j=0;j<this.tabsContainer.childNodes.length;j++){if(this.tabsContainer.childNodes[j].nodeName=="UL"){k=this.tabsContainer.childNodes[j];break}}for(var j=0;j<k.childNodes.length;j++){if(j==l){$ms.addClass(k.childNodes[j],"tab-current")}else{$ms.removeClass(k.childNodes[j],"tab-current")}}$ms.addClass(this.previewOuter,"display-none");$ms.addClass(this.cssOuter,"display-none");$ms.addClass(this.layersOuter,"display-none");$ms.addClass(this.importOuter,"display-none");this.tab=l;if(l==0){$ms.removeClass(this.previewOuter,"display-none");this.previewWrapper2.appendChild(this.preview);this.resizePreview()}else{if(l==1){this.cssText.innerHTML=this.getCssText(this.cssMode);$ms.removeClass(this.cssOuter,"display-none")}else{if(l==2){$ms.removeClass(this.layersOuter,"display-none");this.layersPreviewWrapper.appendChild(this.preview)}else{if(l==3){$ms.removeClass(this.importOuter,"display-none");this.layersPreviewWrapper.appendChild(this.preview)}}}}};d.prototype.colorLibResize=function(j){if(j=="close"){setTimeout(function(){$ms.removeClass(this.tabsContainer,"ms-gradient-tab-container-narrow")}.bind(this),250)}else{$ms.addClass(this.tabsContainer,"ms-gradient-tab-container-narrow")}};d.prototype.save=function(){this.close(true)};d.prototype.cancel=function(j){if(this.settings.startColor&&this.settings.startColor.indexOf("gradient")!==-1){this.showGradientFromString(this.settings.startColor)}else{this.string=undefined}if(this.settings.target){this.updateTarget(true)}this.close(true)};d.prototype.remove=function(){if(this.settings.colorPicker){this.settings.colorPicker.close();this.settings.colorPicker=undefined}if(this.settings.target){this.string=undefined;this.updateTarget()}this.openColorPicker(true);this.close(false)};d.prototype.resetSliders=function(){if(!this.gradient){return}for(var j=0;j<this.cs.length;j++){this.cs[j].slider.arrowInner.parentNode.removeChild(this.cs[j].slider.arrowInner);this.cs[j].slider.close()}};d.prototype.close=function(j){document.body.removeEventListener("DOMAttrModified",this.resize);if(this.container.parentNode){this.container.parentNode.removeChild(this.container)}for(var k=0;k<h.length;k++){if(h[k].id==this.id){h.splice(k,1);break}}this.opacitySlider.close();this.cpLibrary.close();$msRoot.CustomDialog.closeDialogs(this.id);if(this.cs){for(var k=0;k<this.cs.length;k++){this.cs[k].slider.close()}}if(this.settings.colorPicker){this.settings.colorPicker.settings.gradient=undefined;if(j){this.settings.colorPicker.close()}}this.observer.disconnect();if(this.settings.cbClose){if(Array.isArray(this.settings.cbClose)){for(var k=0;k<this.settings.cbClose.length;k++){this.settings.cbClose[k](this)}}else{this.settings.cbClose(this)}}};d.prototype.openColorPicker=function(j){var m,l;if(this.currStop==-1){this.currStop=0}var k=this.cs[this.currStop].rgbString;if(!this.settings.colorPicker){var n=$ms.getOffset(this.container);this.settings.colorPicker=new $msRoot.ColorPicker({startColor:j?this.settings.startColor:k,startMode:"h",startPos:j?{top:n.top,left:n.left}:{top:"10px",left:"20px"},target:j?this.settings.target:undefined,cbChange:j?this.settings.cbChange:undefined,cbCreate:j?this.settings.cbCreate:undefined,cbClose:j?this.settings.cbClose:undefined,imgPath:this.settings.imgPath,container:this.settings.container,zIndex:this.settings.zIndex+1,pin:true,startPinned:j?false:this.settings.pinColorPicker,gradient:j?undefined:this,fromGradientStartColor:j?k:undefined,cbUpdateGradientFromColor:j?undefined:function(o,p){this.cbUpdateGradientFromColor(o,p)}.bind(this)});this.settings.cbUpdateColorPicker=this.settings.colorPicker.cbUpdateColorPicker.bind(this.settings.colorPicker)}this.settings.cbUpdateColorPicker(this.cs[this.currStop]);this.container.style.zIndex=this.settings.zIndex;this.settings.colorPicker.show(this.settings.zIndex+1)};d.prototype.cbUpdateGradientFromColor=function(j){if(this.currStop==-1){return}if(this.updatingColorPicker){return}if(this.colorStopType(this.currStop)!=="color"){return}this.updateStopFromColor(j);this.gradientValuesChanged();this.updateVisuals()};d.prototype.updateTarget=function(l){if(!this.settings.target){return}try{for(var k=0;k<this.settings.target.length;k++){var n=this.settings.target[k];if(this.string){this.setBackground(n.element,this.allLayersString);if(n.valueAttribute){n.element[n.valueAttribute]=this.allLayersString.noPrefix;var j;if(n.textColor=="contrast"){j=$msRoot.colorMethods.highlightcolor(this.cs[0].rgb[0],this.cs[0].rgb[1],this.cs[0].rgb[2])}else{j=this.cs[0].rgbString}n.element.style.color=j}}else{if(l&&this.settings.startColor.length>0){n.element.style.removeProperty("background-image");n.element.style.backgroundColor=this.settings.startColor;if(n.valueAttribute){n.element[n.valueAttribute]=this.settings.startColor}}else{n.element.style.removeProperty("background-image");n.element.style.removeProperty("background-color");if(n.valueAttribute){n.element[n.valueAttribute]=""}}}}if(typeof this.settings.cbChange!=="undefined"){this.settings.cbChange(this,this.string)}}catch(m){console.log("Gradient.updateTarget: "+m.message)}};d.prototype.selectLayer=function(k,n){for(var m=0;m<this.aGradient.length;m++){$ms.removeClass(this.aGradient[m].li,"ms-gradient-layer-selected")}$ms.addClass(k,"ms-gradient-layer-selected");if(!n){return}for(var m=0;m<this.aGradient.length;m++){if(this.aGradient[m].li.id==k.id){this.resetSliders();this.currLayer=m;this.gradient=this.aGradient[m];this.string=this.gradient.string;this.direction.value=this.gradient.direction;this.cs=this.gradient.colorStop;this.colorStopsToSliders();for(var l=0;m<this.cs.length;l++){if(this.cs[l].type=="color"){this.currStop=l;this.selectStopSlider(this.cs[l].slider);break}}$ms.removeClass(this.container,"display-none");this.positionArrows();this.currLayer=m;break}}};d.prototype.addLayer=function(){this.showGradientFromString(this.settings.newLayer,true);this.updateVisuals()};d.prototype.deleteLayer=function(){if(this.currLayer==-1){return}var j=this.aGradient[this.currLayer].li;this.layersUl.removeChild(j);this.aGradient.splice(this.currLayer,1);if(this.aGradient.length==0){this.showGradientFromString(this.settings.newLayer,true);return}if(this.currLayer>this.aGradient.length-1){this.currLayer=this.aGradient.length-1}this.selectLayer(this.aGradient[this.currLayer].li,true);this.updateVisuals()};d.prototype.degreesDialog=function(){if(typeof this.aGradient[this.currLayer].degrees=="undefined"){this.aGradient[this.currLayer].degrees==""}var j={id:this.id,dialogTitle:"Angle",text:"Enter the number of degrees",buttons:[{label:"Ok",enterKey:true,cb:function(k){this.degreesDialogOpen=false;if(k){this.degreesChange(k.settings.input.element.value)}}.bind(this)},{label:"Cancel",escapeKey:true,title:"Do not load the gradient",cb:function(k){this.degreesDialogOpen=false;this.direction.value="to bottom";this.gradient.direction=this.direction.value;this.gradient.degrees="";this.updateVisuals()}.bind(this)}],input:{label:"Angle: ",value:this.aGradient[this.currLayer].degrees,onkeydown:function(k){this.keydown(k,0,360,this.degreesChange)}.bind(this),onkeyup:function(k){this.degreesChange(k)}.bind(this)}};dialog=new $msRoot.CustomDialog(j);this.degreesDialogOpen=true};d.prototype.degreesChange=function(j){if(typeof j=="object"){j=j.target.value}j=this.validateDegrees(j);if(j===""){this.direction.value="to bottom";this.gradient.direction=this.direction.value;this.gradient.degrees="";this.updateVisuals();return}this.direction.value=this.addDegreeComboOption(j);this.gradient.direction=this.direction.value;this.gradient.degrees=j;this.updateVisuals()};d.prototype.validateDegrees=function(j){j=parseInt(j.replace("degrees: ","").trim());if(isNaN(parseInt(j))){return""}else{if(j>360||j<0){return""}}return j};d.prototype.updateFromDragDrop=function(m,o,j,n){var p,l;for(var k=0;k<this.layersUl.childNodes.length;k++){if(m.id==this.layersUl.childNodes[k].id){p=k;break}}for(var k=0;k<this.aGradient.length;k++){if(m.id==this.aGradient[k].li.id){l=k;break}}if(typeof p=="undefined"||typeof l=="undefined"){console.log("Gradient drag drop - cannot find element");return}else{if(p==l){return}}$ms.arrayMove(this.aGradient,l,p);this.selectLayer(this.aGradient[p].li,true);this.updateVisuals()};d.prototype.resizePreview=function(){if(this.tab!==0){return}var n=false;var k=this.previewWidth.value;var j=this.previewHeight.value;var m=$ms.getOffset(this.previewWrapper).width-2;var l=$ms.getOffset(this.previewWrapper).height-2;if(isNaN(k)||isNaN(j)){n=true}if(n){this.previewWrapper2.style.removeProperty("width");this.previewWrapper2.style.removeProperty("height")}else{var p=m/l;var o=k/j;if(o>0){this.previewWrapper2.style.removeProperty("width");k=Math.min(m,k);j=k/o;if(j>l){j=l;k=j*o}}else{this.previewWrapper2.style.removeProperty("height");j=Math.min(l,j);k=j*o;if(k>m){k=m;j=k/o}}this.previewWrapper2.style.width=k+"px";this.previewWrapper2.style.height=j+"px"}};d.prototype.directionToAngle=function(j){var k=90;switch(j){case"to bottom":k=270;break;case"to right":k=0;break;case"to top":k=90;break;case"to left":k=180;break;case"135deg":case"to top left":k=135;break;case"45deg":case"to top right":k=45;break;case"315deg":case"to bottom right":k=315;break;case"225deg":case"to bottom left":k=225;break;case"radial":k="radial";break;default:if(j.indexOf("deg")!==-1){k=parseInt(j)}break}return k};d.prototype.angleToDirection=function(k){k=parseInt(""+k);var j="to bottom";if(isNaN(k)){return j}switch(k){case 270:j="to bottom";break;case 0:j="to right";break;case 90:j="to top";break;case 180:j="to left";break;case 135:j="to top left";break;case 45:j="to top right";break;case 315:j="to bottom right";break;case 225:j="to bottom left";break;default:j=false}return j};d.prototype.downloadPNG=function(n,t){var r=document.body;var F;var w;var k,o;if(!n){return false}if(Array.isArray(n)){o=n}else{o=[n]}t.width=parseInt(t.width);if(isNaN(t.width)||t.width==0){t.width=200}t.height=parseInt(t.height);if(isNaN(t.height)||t.height==0){t.height=200}var m=document.createElement("canvas");m.id=this.id+"canvas";var s=false;for(var A=0;A<o.length;A++){if(this.directionToAngle(o[A].direction)=="radial"){s=true}else{if(s){s=false;break}}}if(s){var q={width:t.width,height:t.height};t.width=Math.max(t.width,t.height);t.height=Math.max(t.width,t.height);m.width=Math.max(t.width,t.height);m.height=Math.max(t.width,t.height)}else{m.style.width=t.width+"px";m.style.height=t.height+"px";m.width=t.width;m.height=t.height}w=m.getContext("2d");for(var y=o.length-1;y>=0;y--){k=o[y];var C=k.colorStop.slice();for(var v=C.length-1;v>=0;v--){for(var u=v-1;u>=0;u--){if(C[v].rgbString===C[u].rgbString&&parseInt(C[v].position)==parseInt(C[u].position)){C.splice(v,1);break}}}C.sort(function(G,j){return G.position-j.position});var B=this.directionToAngle(k.direction);if(B=="radial"){var z={x1:0,y1:0,x2:0,y2:0};z.x1=(t.width/2);z.x2=z.x1;z.y1=(t.height/2);z.y2=z.y1;z.r1=0;z.r2=Math.min(t.height,t.width);F=w.createRadialGradient(z.x1,z.y1,z.r1,z.x2,z.y2,z.r2);var p=q.width/q.height;if(p>1){w.scale(1/p,1)}else{if(p<1){w.scale(p,1)}}}else{var z=this.cssAngleToCanvasCoords(t.width,t.height,B);F=w.createLinearGradient(z.x1,z.y1,z.x2,z.y2)}var E,x;for(var A=0;A<C.length;A++){x=C[A].rgbString;E=C[A].position/100;F.addColorStop(E,x);w.fillStyle=F}w.fillRect(0,0,m.width,m.height)}if(s){var D=w.getImageData(0,0,q.width,q.height);w.canvas.width=q.width;w.canvas.height=q.height;w.putImageData(D,0,0)}l(m,"gradient.png");m=undefined;function l(H,G){if(navigator.msSaveBlob){var j=H.msToBlob();return navigator.msSaveBlob(j,G)}else{var K=H.toDataURL("image/png");var J=document.createElement("a");J.download=G;J.href=K;document.body.appendChild(J);if(J.click){J.click()}else{var I=document.createEvent("MouseEvents");I.initMouseEvent("click",true,true,window);J.dispatchEvent(I)}document.body.removeChild(J)}}};d.prototype.cssAngleToCanvasCoords=function(l,u,m){var q=180/Math.PI;var m=m/q;var r;var s,p;if(v(m,l,u)){r="right";s=l/2;p=l/2*Math.tan(m)}else{if(j(m,l,u)){r="top";s=-u/2*Math.tan(m-Math.PI/2);p=u/2}else{if(t(m,l,u)){r="left";s=-l/2;p=-l/2*Math.tan(m-Math.PI)}else{if(n(m,l,u)){r="bottom";s=u/2*Math.tan(m-3*Math.PI/2);p=-u/2}}}}s+=l/2;p-=u/2;p*=-1;var o=k(l,u,r,{x:s,y:p});return o;function v(y,x,w){var z=Math.atan2(w,x);return y<z||Math.abs(y-2*Math.PI)<z}function j(y,x,w){var z=Math.atan2(x,w);return Math.abs(y-Math.PI/2)<z}function t(y,x,w){var z=Math.atan2(w,x);return Math.abs(y-Math.PI)<z}function n(y,x,w){var z=Math.atan2(x,w);return Math.abs(y-3*Math.PI/2)<z}function k(C,x,D,w){var z,y,B,A;y=w.x;A=w.y;if(D=="right"){z=0;B=x-w.y}else{if(D=="top"){z=C-w.x;B=x}else{if(D=="left"){z=C;B=x-w.y}else{if(D=="bottom"){z=C-w.x;B=0}}}}return{x1:z,y1:B,x2:y,y2:A}}};return d})();